{
    "componentChunkName": "component---src-templates-md-blog-post-js",
    "path": "/posts/2020-11-23-dragon-ctf-2020-bit-flip-writeups",
    "result": {"data":{"markdownRemark":{"html":"<p>Only managed to solve Bit Flip 1 during the CTF :(. The other challenges were quite interesting.</p>\n<ul>\n<li><a href=\"#bit-flip-1\">Bit Flip 1</a></li>\n<li><a href=\"#bit-flip-2\">Bit Flip 2</a></li>\n<li><a href=\"#bit-flip-3\">Bit Flip 3</a></li>\n</ul>\n<h1>Bit Flip 1 <a name=\"bit-flip-1\"></a></h1>\n<blockquote>\n<p>Flip bits and decrypt communication between Bob and Alice.</p>\n<p>nc bitflip1.hackable.software 1337</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\">#!/usr/bin/python3</span>\n\n<span class=\"token keyword\">from</span> Crypto<span class=\"token punctuation\">.</span>Util<span class=\"token punctuation\">.</span>number <span class=\"token keyword\">import</span> bytes_to_long<span class=\"token punctuation\">,</span> long_to_bytes\n<span class=\"token keyword\">from</span> Crypto<span class=\"token punctuation\">.</span>Cipher <span class=\"token keyword\">import</span> AES\n<span class=\"token keyword\">import</span> hashlib\n<span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">import</span> base64\n<span class=\"token keyword\">from</span> gmpy2 <span class=\"token keyword\">import</span> is_prime\n\nFLAG <span class=\"token operator\">=</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"flag\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rb\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nFLAG <span class=\"token operator\">+=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">16</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>FLAG<span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token string\">b\" \"</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Rng</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> seed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    self<span class=\"token punctuation\">.</span>seed <span class=\"token operator\">=</span> seed\n    self<span class=\"token punctuation\">.</span>generated <span class=\"token operator\">=</span> <span class=\"token string\">b\"\"</span>\n    self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token function\">more_bytes</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    self<span class=\"token punctuation\">.</span>generated <span class=\"token operator\">+=</span> hashlib<span class=\"token punctuation\">.</span>sha256<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>seed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>digest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    self<span class=\"token punctuation\">.</span>seed <span class=\"token operator\">=</span> long_to_bytes<span class=\"token punctuation\">(</span>bytes_to_long<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>seed<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">)</span>\n    self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">+=</span> <span class=\"token number\">256</span>\n\n\n  <span class=\"token keyword\">def</span> <span class=\"token function\">getbits</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> num<span class=\"token operator\">=</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">&lt;</span> num<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n      self<span class=\"token punctuation\">.</span>more_bytes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    x <span class=\"token operator\">=</span> bytes_to_long<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>generated<span class=\"token punctuation\">)</span>\n    self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">-=</span> num\n    self<span class=\"token punctuation\">.</span>generated <span class=\"token operator\">=</span> <span class=\"token string\">b\"\"</span>\n    <span class=\"token keyword\">if</span> self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n      self<span class=\"token punctuation\">.</span>generated <span class=\"token operator\">=</span> long_to_bytes<span class=\"token punctuation\">(</span>x <span class=\"token operator\">>></span> num<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">//</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> x <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">&lt;&lt;</span> num<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">DiffieHellman</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">def</span> <span class=\"token function\">gen_prime</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    prime <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>rng<span class=\"token punctuation\">.</span>getbits<span class=\"token punctuation\">(</span><span class=\"token number\">512</span><span class=\"token punctuation\">)</span>\n    <span class=\"token builtin\">iter</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">while</span> <span class=\"token keyword\">not</span> is_prime<span class=\"token punctuation\">(</span>prime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n      <span class=\"token builtin\">iter</span> <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n      prime <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>rng<span class=\"token punctuation\">.</span>getbits<span class=\"token punctuation\">(</span><span class=\"token number\">512</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Generated after\"</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">iter</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"iterations\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> prime\n\n  <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> seed<span class=\"token punctuation\">,</span> prime<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    self<span class=\"token punctuation\">.</span>rng <span class=\"token operator\">=</span> Rng<span class=\"token punctuation\">(</span>seed<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> prime <span class=\"token keyword\">is</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n      prime <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>gen_prime<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    self<span class=\"token punctuation\">.</span>prime <span class=\"token operator\">=</span> prime\n    self<span class=\"token punctuation\">.</span>my_secret <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>rng<span class=\"token punctuation\">.</span>getbits<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    self<span class=\"token punctuation\">.</span>my_number <span class=\"token operator\">=</span> <span class=\"token builtin\">pow</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>my_secret<span class=\"token punctuation\">,</span> prime<span class=\"token punctuation\">)</span>\n    self<span class=\"token punctuation\">.</span>shared <span class=\"token operator\">=</span> <span class=\"token number\">1337</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token function\">set_other</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    self<span class=\"token punctuation\">.</span>shared <span class=\"token operator\">^</span><span class=\"token operator\">=</span> <span class=\"token builtin\">pow</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>my_secret<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>prime<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">pad32</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token string\">b\"\\x00\"</span><span class=\"token operator\">*</span><span class=\"token number\">32</span><span class=\"token operator\">+</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">32</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">xor32</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">return</span> <span class=\"token builtin\">bytes</span><span class=\"token punctuation\">(</span>x<span class=\"token operator\">^</span>y <span class=\"token keyword\">for</span> x<span class=\"token punctuation\">,</span> y <span class=\"token keyword\">in</span> <span class=\"token builtin\">zip</span><span class=\"token punctuation\">(</span>pad32<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> pad32<span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">bit_flip</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bit-flip str:\"</span><span class=\"token punctuation\">)</span>\n  flip_str <span class=\"token operator\">=</span> base64<span class=\"token punctuation\">.</span>b64decode<span class=\"token punctuation\">(</span><span class=\"token builtin\">input</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> xor32<span class=\"token punctuation\">(</span>flip_str<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span>\n\n\nalice_seed <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>urandom<span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">while</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n  alice <span class=\"token operator\">=</span> DiffieHellman<span class=\"token punctuation\">(</span>bit_flip<span class=\"token punctuation\">(</span>alice_seed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  bob <span class=\"token operator\">=</span> DiffieHellman<span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">.</span>urandom<span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> alice<span class=\"token punctuation\">.</span>prime<span class=\"token punctuation\">)</span>\n\n  alice<span class=\"token punctuation\">.</span>set_other<span class=\"token punctuation\">(</span>bob<span class=\"token punctuation\">.</span>my_number<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bob number\"</span><span class=\"token punctuation\">,</span> bob<span class=\"token punctuation\">.</span>my_number<span class=\"token punctuation\">)</span>\n  bob<span class=\"token punctuation\">.</span>set_other<span class=\"token punctuation\">(</span>alice<span class=\"token punctuation\">.</span>my_number<span class=\"token punctuation\">)</span>\n  iv <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>urandom<span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>base64<span class=\"token punctuation\">.</span>b64encode<span class=\"token punctuation\">(</span>iv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  cipher <span class=\"token operator\">=</span> AES<span class=\"token punctuation\">.</span>new<span class=\"token punctuation\">(</span>long_to_bytes<span class=\"token punctuation\">(</span>alice<span class=\"token punctuation\">.</span>shared<span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">16</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> AES<span class=\"token punctuation\">.</span>MODE_CBC<span class=\"token punctuation\">,</span> IV<span class=\"token operator\">=</span>iv<span class=\"token punctuation\">)</span>\n  enc_flag <span class=\"token operator\">=</span> cipher<span class=\"token punctuation\">.</span>encrypt<span class=\"token punctuation\">(</span>FLAG<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>base64<span class=\"token punctuation\">.</span>b64encode<span class=\"token punctuation\">(</span>enc_flag<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Solution</h2>\n<p>The server is using a custom RNG to generate the prime and private keys for a Diffie Hellman key exchange between Alice and Bob. The seeds used for the RNG are random, except we can slightly control Alice's seed by flipping bits. Notice that if we can determine Alice's seed, we can determine her secret number too and therefore recover the shared secret used as the AES key.</p>\n<h3>Recovering Alice's Seed</h3>\n<p>We are curiously given the number of iterations required by the RNG to generate the prime. We can use this data to mount a timing attack to iteratively recover Alice's seed bit by bit.</p>\n<p>First, we inspect how the RNG generates bits. It does so by taking the desired number of bits from the LSB of the <code>sha256</code> hash of the seed. If more bits are required, it increments the seed and outputs the desired number of bits from the LSB of the <code>sha256</code> hash of that. Since the prime being generated is 512 bits, the call to <code>self.rng.getbits(512)</code> will output <code>sha256(s) + sha256(s+1)</code>. Effectively, the seed is incremented by 2 for each \"iteration\" of the prime generation.</p>\n<p>Our exploit will start by guessing the LSB of Alice's seed (so it will succeed only 50% of the time, but this is good enough).</p>\n<p>For simplicity and ease of working with bit operations, we'll use binary for describing the seed and flip bitstrings.</p>\n<p>Now, suppose we don't flip any bits and we see that the number of iterations is <code>t</code>. If we flip the second LSB (i.e. using the flip bitstring <code>10</code>), then the number of iterations will be either <code>t-1</code> or <code>t+1</code>. If the second LSB of Alice's seed is a <code>1</code>, then flipping that bit will effectively subtract <code>2</code> from the seed, so the RNG will require one extra iteration to generate the prime (so we will get <code>t+1</code> iterations). On the other hand, if the second LSB of Alice's seed is a <code>0</code>, then flipping that bit will effectively add <code>2</code> to the seed, so the RNG will require one less iteration to generate the prime (so we will get <code>t-1</code> iterations).</p>\n<p>Now let <code>s</code> be the current known seed of length <code>l</code>. Let <code>f</code> denote the bit string that you get by flipping each bit in <code>s</code> except the last. For example if <code>s = 1010110</code>, then <code>f = 0101000</code>. Let <code>num_iters(x)</code> denote the number of iterations returned by the server when applying a flip bitstring of <code>x</code>.</p>\n<p>Let</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">A = num_iters(f)\nB = num_iters('1'+f)\nC = num_iters(s)\nD = num_iters('1'+s)</code></pre></div>\n<p>Then,</p>\n<p>If the <code>l+1</code>st LSB of Alice's seed is a <code>1</code>, then <code>B - C == 1</code>.</p>\n<p>If the <code>l+1</code>st LSB of Alice's seed is a <code>0</code>, then <code>A - D == 1</code>.</p>\n<p>To see why this holds, suppose for example that the first <code>l</code> LSB of Alice's seed is <code>110010110</code> and the <code>l+1</code>st LSB of the seed is a <code>1</code>. Then we have the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">                       &lt;---l--->\n    Alice's seed : ...1110010110\n[1] flip by '1'+f: ...0111111110\n[2] flip by s    : ...1000000000 </code></pre></div>\n<p>Notice that the numerical diference between <code>[2]</code> and <code>[1]</code> will be <code>2</code>. Therefore, flipping by <code>s</code> will require one extra iteration compared to flipping by <code>'1'+f</code>. Hence <code>B - C == 1</code>.</p>\n<p>Similar reasoning can be applied to show why the other case holds.</p>\n<p>We use this to recover each bit in Alice's seed.</p>\n<h3>Grabbing The Flag</h3>\n<p>Now that we have Alice's seed, we can simulate the generation of the prime and her secret number. We use these with Bob's public key to compute the shared key and decrypt the flag.</p>\n<p><strong>Solve script:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> os\nos<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">[</span><span class=\"token string\">'PWNLIB_NOTERM'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'True'</span>\n<span class=\"token keyword\">from</span> pwn <span class=\"token keyword\">import</span> remote<span class=\"token punctuation\">,</span> process\n<span class=\"token keyword\">from</span> Crypto<span class=\"token punctuation\">.</span>Util<span class=\"token punctuation\">.</span>number <span class=\"token keyword\">import</span> long_to_bytes<span class=\"token punctuation\">,</span> bytes_to_long<span class=\"token punctuation\">,</span> isPrime\n<span class=\"token keyword\">from</span> Crypto<span class=\"token punctuation\">.</span>Cipher <span class=\"token keyword\">import</span> AES\n<span class=\"token keyword\">from</span> base64 <span class=\"token keyword\">import</span> b64encode<span class=\"token punctuation\">,</span> b64decode\n<span class=\"token keyword\">import</span> subprocess\n<span class=\"token keyword\">import</span> hashlib\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Rng</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> seed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>seed <span class=\"token operator\">=</span> seed\n        self<span class=\"token punctuation\">.</span>generated <span class=\"token operator\">=</span> <span class=\"token string\">b\"\"</span>\n        self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">more_bytes</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>generated <span class=\"token operator\">+=</span> hashlib<span class=\"token punctuation\">.</span>sha256<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>seed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>digest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>seed <span class=\"token operator\">=</span> long_to_bytes<span class=\"token punctuation\">(</span>bytes_to_long<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>seed<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">+=</span> <span class=\"token number\">256</span>\n\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">getbits</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> num<span class=\"token operator\">=</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">&lt;</span> num<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            self<span class=\"token punctuation\">.</span>more_bytes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        x <span class=\"token operator\">=</span> bytes_to_long<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>generated<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">-=</span> num\n        self<span class=\"token punctuation\">.</span>generated <span class=\"token operator\">=</span> <span class=\"token string\">b\"\"</span>\n        <span class=\"token keyword\">if</span> self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n            self<span class=\"token punctuation\">.</span>generated <span class=\"token operator\">=</span> long_to_bytes<span class=\"token punctuation\">(</span>x <span class=\"token operator\">>></span> num<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">//</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> x <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">&lt;&lt;</span> num<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">gen_prime_and_secret</span><span class=\"token punctuation\">(</span>seed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    rng <span class=\"token operator\">=</span> Rng<span class=\"token punctuation\">(</span>seed<span class=\"token punctuation\">)</span>\n    prime <span class=\"token operator\">=</span> rng<span class=\"token punctuation\">.</span>getbits<span class=\"token punctuation\">(</span><span class=\"token number\">512</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">while</span> <span class=\"token keyword\">not</span> isPrime<span class=\"token punctuation\">(</span>prime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        prime <span class=\"token operator\">=</span> rng<span class=\"token punctuation\">.</span>getbits<span class=\"token punctuation\">(</span><span class=\"token number\">512</span><span class=\"token punctuation\">)</span>\n    secret <span class=\"token operator\">=</span> rng<span class=\"token punctuation\">.</span>getbits<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> prime<span class=\"token punctuation\">,</span> secret\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># return process('./task.py')</span>\n    <span class=\"token keyword\">return</span> remote<span class=\"token punctuation\">(</span><span class=\"token string\">'bitflip1.hackable.software'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1337</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">recv</span><span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    o <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span>recvline<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[&lt;]'</span><span class=\"token punctuation\">,</span> o<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> o\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">send</span><span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[>]'</span><span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">)</span>\n    conn<span class=\"token punctuation\">.</span>sendline<span class=\"token punctuation\">(</span>d<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">solve_pow</span><span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    challenge <span class=\"token operator\">=</span> recv<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n    stamp <span class=\"token operator\">=</span> subprocess<span class=\"token punctuation\">.</span>check_output<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'hashcash'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-mb28'</span><span class=\"token punctuation\">,</span> challenge<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    send<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> stamp<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">do_round</span><span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    recv<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span>\n    x <span class=\"token operator\">=</span> b64encode<span class=\"token punctuation\">(</span>long_to_bytes<span class=\"token punctuation\">(</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    send<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># iters = int(recv(conn).split(' ')[-1])</span>\n    iters <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>recv<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">'after '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    bob <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>recv<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">'number '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    iv <span class=\"token operator\">=</span> b64decode<span class=\"token punctuation\">(</span>recv<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    ct <span class=\"token operator\">=</span> b64decode<span class=\"token punctuation\">(</span>recv<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> iters<span class=\"token punctuation\">,</span> bob<span class=\"token punctuation\">,</span> iv<span class=\"token punctuation\">,</span> ct\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">num_iters</span><span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> do_round<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">flip</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># x is a bit string</span>\n    <span class=\"token keyword\">return</span> x<span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">'0'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'x'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'0'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">'x'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">)</span>\n\nconn <span class=\"token operator\">=</span> connect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nsolve_pow<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span>\n\nalice_seed <span class=\"token operator\">=</span> <span class=\"token string\">'0'</span>\nt <span class=\"token operator\">=</span> num_iters<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> <span class=\"token string\">'0'</span><span class=\"token punctuation\">)</span>\nt2 <span class=\"token operator\">=</span> num_iters<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> <span class=\"token string\">'10'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> t2 <span class=\"token operator\">==</span> t <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n    alice_seed <span class=\"token operator\">=</span> <span class=\"token string\">'00'</span>\n<span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n    alice_seed <span class=\"token operator\">=</span> <span class=\"token string\">'10'</span>\n\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">126</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    f <span class=\"token operator\">=</span> flip<span class=\"token punctuation\">(</span>alice_seed<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'0'</span>\n    A <span class=\"token operator\">=</span> num_iters<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> f<span class=\"token punctuation\">)</span>\n    B <span class=\"token operator\">=</span> num_iters<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> <span class=\"token string\">'1'</span><span class=\"token operator\">+</span>f<span class=\"token punctuation\">)</span>\n    C <span class=\"token operator\">=</span> num_iters<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> alice_seed<span class=\"token punctuation\">)</span>\n    D <span class=\"token operator\">=</span> num_iters<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> <span class=\"token string\">'1'</span><span class=\"token operator\">+</span>alice_seed<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> B <span class=\"token operator\">-</span> C <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n        alice_seed <span class=\"token operator\">=</span> <span class=\"token string\">'1'</span> <span class=\"token operator\">+</span> alice_seed\n    <span class=\"token keyword\">elif</span> A <span class=\"token operator\">-</span> D <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n        alice_seed <span class=\"token operator\">=</span> <span class=\"token string\">'0'</span> <span class=\"token operator\">+</span> alice_seed\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[!] unexpected branch'</span><span class=\"token punctuation\">)</span>\n        exit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[+] alice_seed:'</span><span class=\"token punctuation\">,</span> alice_seed<span class=\"token punctuation\">)</span>\n\n_<span class=\"token punctuation\">,</span> bob<span class=\"token punctuation\">,</span> iv<span class=\"token punctuation\">,</span> ct <span class=\"token operator\">=</span> do_round<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> <span class=\"token string\">'0'</span><span class=\"token punctuation\">)</span>\nprime<span class=\"token punctuation\">,</span> secret <span class=\"token operator\">=</span> gen_prime_and_secret<span class=\"token punctuation\">(</span>long_to_bytes<span class=\"token punctuation\">(</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>alice_seed<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[+] prime:'</span><span class=\"token punctuation\">,</span> prime<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[+] secret:'</span><span class=\"token punctuation\">,</span> secret<span class=\"token punctuation\">)</span>\nmy_number <span class=\"token operator\">=</span> <span class=\"token builtin\">pow</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> secret<span class=\"token punctuation\">,</span> prime<span class=\"token punctuation\">)</span>\nshared <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">pow</span><span class=\"token punctuation\">(</span>bob<span class=\"token punctuation\">,</span> secret<span class=\"token punctuation\">,</span> prime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span><span class=\"token operator\">^</span> <span class=\"token number\">1337</span>\ncipher <span class=\"token operator\">=</span> AES<span class=\"token punctuation\">.</span>new<span class=\"token punctuation\">(</span>long_to_bytes<span class=\"token punctuation\">(</span>shared<span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">16</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> AES<span class=\"token punctuation\">.</span>MODE_CBC<span class=\"token punctuation\">,</span> IV<span class=\"token operator\">=</span>iv<span class=\"token punctuation\">)</span>\nflag <span class=\"token operator\">=</span> cipher<span class=\"token punctuation\">.</span>decrypt<span class=\"token punctuation\">(</span>ct<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[+] FLAG:'</span><span class=\"token punctuation\">,</span> flag<span class=\"token punctuation\">)</span>\n\nconn<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Flag: <code>DrgnS{T1min9_4ttack_f0r_k3y_generation}</code></p>\n<h1>Bit Flip 2 <a name=\"bit-flip-2\"></a></h1>\n<blockquote>\n<p>Flip bits and decrypt communication between Bob and Alice, but this time Bob is not so talkative.</p>\n<p>nc bitflip2.hackable.software 1337</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\">#!/usr/bin/python3</span>\n\n<span class=\"token keyword\">from</span> Crypto<span class=\"token punctuation\">.</span>Util<span class=\"token punctuation\">.</span>number <span class=\"token keyword\">import</span> bytes_to_long<span class=\"token punctuation\">,</span> long_to_bytes\n<span class=\"token keyword\">from</span> Crypto<span class=\"token punctuation\">.</span>Cipher <span class=\"token keyword\">import</span> AES\n<span class=\"token keyword\">import</span> hashlib\n<span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">import</span> base64\n<span class=\"token keyword\">from</span> gmpy2 <span class=\"token keyword\">import</span> is_prime\n\nFLAG <span class=\"token operator\">=</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"flag\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rb\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nFLAG <span class=\"token operator\">+=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">16</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>FLAG<span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token string\">b\" \"</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Rng</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> seed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    self<span class=\"token punctuation\">.</span>seed <span class=\"token operator\">=</span> seed\n    self<span class=\"token punctuation\">.</span>generated <span class=\"token operator\">=</span> <span class=\"token string\">b\"\"</span>\n    self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token function\">more_bytes</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    self<span class=\"token punctuation\">.</span>generated <span class=\"token operator\">+=</span> hashlib<span class=\"token punctuation\">.</span>sha256<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>seed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>digest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    self<span class=\"token punctuation\">.</span>seed <span class=\"token operator\">=</span> long_to_bytes<span class=\"token punctuation\">(</span>bytes_to_long<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>seed<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">)</span>\n    self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">+=</span> <span class=\"token number\">256</span>\n\n\n  <span class=\"token keyword\">def</span> <span class=\"token function\">getbits</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> num<span class=\"token operator\">=</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">&lt;</span> num<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n      self<span class=\"token punctuation\">.</span>more_bytes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    x <span class=\"token operator\">=</span> bytes_to_long<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>generated<span class=\"token punctuation\">)</span>\n    self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">-=</span> num\n    self<span class=\"token punctuation\">.</span>generated <span class=\"token operator\">=</span> <span class=\"token string\">b\"\"</span>\n    <span class=\"token keyword\">if</span> self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n      self<span class=\"token punctuation\">.</span>generated <span class=\"token operator\">=</span> long_to_bytes<span class=\"token punctuation\">(</span>x <span class=\"token operator\">>></span> num<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">//</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> x <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">&lt;&lt;</span> num<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">DiffieHellman</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">def</span> <span class=\"token function\">gen_prime</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    prime <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>rng<span class=\"token punctuation\">.</span>getbits<span class=\"token punctuation\">(</span><span class=\"token number\">512</span><span class=\"token punctuation\">)</span>\n    <span class=\"token builtin\">iter</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">while</span> <span class=\"token keyword\">not</span> is_prime<span class=\"token punctuation\">(</span>prime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n      <span class=\"token builtin\">iter</span> <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n      prime <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>rng<span class=\"token punctuation\">.</span>getbits<span class=\"token punctuation\">(</span><span class=\"token number\">512</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Generated after\"</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">iter</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"iterations\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> prime\n\n  <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> seed<span class=\"token punctuation\">,</span> prime<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    self<span class=\"token punctuation\">.</span>rng <span class=\"token operator\">=</span> Rng<span class=\"token punctuation\">(</span>seed<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> prime <span class=\"token keyword\">is</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n      prime <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>gen_prime<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    self<span class=\"token punctuation\">.</span>prime <span class=\"token operator\">=</span> prime\n    self<span class=\"token punctuation\">.</span>my_secret <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>rng<span class=\"token punctuation\">.</span>getbits<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    self<span class=\"token punctuation\">.</span>my_number <span class=\"token operator\">=</span> <span class=\"token builtin\">pow</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>my_secret<span class=\"token punctuation\">,</span> prime<span class=\"token punctuation\">)</span>\n    self<span class=\"token punctuation\">.</span>shared <span class=\"token operator\">=</span> <span class=\"token number\">1337</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token function\">set_other</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    self<span class=\"token punctuation\">.</span>shared <span class=\"token operator\">^</span><span class=\"token operator\">=</span> <span class=\"token builtin\">pow</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>my_secret<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>prime<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">pad32</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token string\">b\"\\x00\"</span><span class=\"token operator\">*</span><span class=\"token number\">32</span><span class=\"token operator\">+</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">32</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">xor32</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">return</span> <span class=\"token builtin\">bytes</span><span class=\"token punctuation\">(</span>x<span class=\"token operator\">^</span>y <span class=\"token keyword\">for</span> x<span class=\"token punctuation\">,</span> y <span class=\"token keyword\">in</span> <span class=\"token builtin\">zip</span><span class=\"token punctuation\">(</span>pad32<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> pad32<span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">bit_flip</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bit-flip str:\"</span><span class=\"token punctuation\">)</span>\n  flip_str <span class=\"token operator\">=</span> base64<span class=\"token punctuation\">.</span>b64decode<span class=\"token punctuation\">(</span><span class=\"token builtin\">input</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> xor32<span class=\"token punctuation\">(</span>flip_str<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span>\n\n\nalice_seed <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>urandom<span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">while</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n  alice <span class=\"token operator\">=</span> DiffieHellman<span class=\"token punctuation\">(</span>bit_flip<span class=\"token punctuation\">(</span>alice_seed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  bob <span class=\"token operator\">=</span> DiffieHellman<span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">.</span>urandom<span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> alice<span class=\"token punctuation\">.</span>prime<span class=\"token punctuation\">)</span>\n\n  alice<span class=\"token punctuation\">.</span>set_other<span class=\"token punctuation\">(</span>bob<span class=\"token punctuation\">.</span>my_number<span class=\"token punctuation\">)</span>\n  <span class=\"token comment\"># print(\"bob number\", bob.my_number)</span>\n  bob<span class=\"token punctuation\">.</span>set_other<span class=\"token punctuation\">(</span>alice<span class=\"token punctuation\">.</span>my_number<span class=\"token punctuation\">)</span>\n  iv <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>urandom<span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>base64<span class=\"token punctuation\">.</span>b64encode<span class=\"token punctuation\">(</span>iv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  cipher <span class=\"token operator\">=</span> AES<span class=\"token punctuation\">.</span>new<span class=\"token punctuation\">(</span>long_to_bytes<span class=\"token punctuation\">(</span>alice<span class=\"token punctuation\">.</span>shared<span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">16</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> AES<span class=\"token punctuation\">.</span>MODE_CBC<span class=\"token punctuation\">,</span> IV<span class=\"token operator\">=</span>iv<span class=\"token punctuation\">)</span>\n  enc_flag <span class=\"token operator\">=</span> cipher<span class=\"token punctuation\">.</span>encrypt<span class=\"token punctuation\">(</span>FLAG<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>base64<span class=\"token punctuation\">.</span>b64encode<span class=\"token punctuation\">(</span>enc_flag<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Solution</h2>\n<p>The only difference between <code>Bit Flip 1</code> and <code>Bit Flip 2</code> is that in <code>Bit Flip 2</code> we aren't given Bob's public key:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">❯ <span class=\"token function\">diff</span> task-1.py task-2.py\n79c79\n<span class=\"token operator\">&lt;</span>   print<span class=\"token punctuation\">(</span><span class=\"token string\">\"bob number\"</span>, bob.my_number<span class=\"token punctuation\">)</span>\n---\n<span class=\"token operator\">></span>   <span class=\"token comment\"># print(\"bob number\", bob.my_number)</span></code></pre></div>\n<p>From <code>Bit Flip 1</code>, we know that we are able to control Alice's seed. If we weren't able to do this, the challenge would be impossible, so the task is essentially to find a seed for Alice's RNG that will let us somehow figure out what the shared secret is without needing Bob's public key.</p>\n<p>Some initial thoughts I had was to try and bruteforce seeds and look for primes that make the order of the generator (<code>g = 5</code>) small. I realised that this approach would not work at all as the order of <code>g</code> is rarely small enough since the prime is 512 bits.</p>\n<p>I learnt of the intended solution after the CTF. The way to solve the challenge is by forcing Alice's secret to be <code>0</code>, so that the shared secret will end up being <code>1337 ^ 1 = 1336</code>. This is done by finding a seed such that the <code>sha256</code> of the seed after the prime has been generated has at least 8 trailing zeroes. I had no idea about this, but it turns out that hashes for blocks on the Bitcoin blockchain are of this form (the proof-of-work scheme involves finding such strings. read more about it <a href=\"https://en.bitcoin.it/wiki/Proof_of_work\">here</a> and <a href=\"https://en.bitcoin.it/wiki/Block_hashing_algorithm\">here</a>).</p>\n<p>The hash of the block is given by <code>sha256(h)</code> where <code>h = sha256(header)</code> is the <code>sha256</code> of the block's header. So to solve the challenge, we search the blockchain for blocks that satisfy <code>isPrime(sha256(h-2) + sha256(h-1))</code>. Then, the seed <code>h-2</code> will produce a prime, and Alice's secret key will be given by <code>sha256(h)</code>, which has 8 trailing zeroes.</p>\n<p>To search the blockchain and get the relevant data about each block, we use the <a href=\"https://explorer.api.bitcoin.com/docs/bch/v1/\">Bitcoin.com Explorer API</a>.</p>\n<p><strong>Solve script:</strong></p>\n<p>Finding the block hash:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> Crypto<span class=\"token punctuation\">.</span>Util<span class=\"token punctuation\">.</span>number <span class=\"token keyword\">import</span> long_to_bytes<span class=\"token punctuation\">,</span> bytes_to_long<span class=\"token punctuation\">,</span> isPrime\n<span class=\"token keyword\">from</span> hashlib <span class=\"token keyword\">import</span> sha256\n<span class=\"token keyword\">from</span> tqdm <span class=\"token keyword\">import</span> tqdm\n<span class=\"token keyword\">from</span> requests <span class=\"token keyword\">import</span> Session\n\ns  <span class=\"token operator\">=</span> Session<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_blocks_list</span><span class=\"token punctuation\">(</span>block_date<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  block_list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  d <span class=\"token operator\">=</span> <span class=\"token string\">''</span> <span class=\"token keyword\">if</span> block_date <span class=\"token keyword\">is</span> <span class=\"token boolean\">None</span> <span class=\"token keyword\">else</span> <span class=\"token string\">'?blockDate='</span><span class=\"token operator\">+</span>block_date\n  block_list <span class=\"token operator\">=</span> s<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'https://explorer.api.bitcoin.com/bch/v1/blocks'</span><span class=\"token operator\">+</span>d<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>b<span class=\"token punctuation\">[</span><span class=\"token string\">'hash'</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">for</span> b <span class=\"token keyword\">in</span> block_list<span class=\"token punctuation\">[</span><span class=\"token string\">'blocks'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> block_list<span class=\"token punctuation\">[</span><span class=\"token string\">'pagination'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'prev'</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_block_data</span><span class=\"token punctuation\">(</span>block_hash<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  block_data <span class=\"token operator\">=</span> s<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'https://explorer.api.bitcoin.com/bch/v1/block/'</span><span class=\"token operator\">+</span>block_hash<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  d <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  d<span class=\"token punctuation\">[</span><span class=\"token string\">'hash'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> block_data<span class=\"token punctuation\">[</span><span class=\"token string\">'hash'</span><span class=\"token punctuation\">]</span>\n  d<span class=\"token punctuation\">[</span><span class=\"token string\">'version'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> block_data<span class=\"token punctuation\">[</span><span class=\"token string\">'version'</span><span class=\"token punctuation\">]</span>\n  d<span class=\"token punctuation\">[</span><span class=\"token string\">'merkleroot'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> block_data<span class=\"token punctuation\">[</span><span class=\"token string\">'merkleroot'</span><span class=\"token punctuation\">]</span>\n  d<span class=\"token punctuation\">[</span><span class=\"token string\">'time'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> block_data<span class=\"token punctuation\">[</span><span class=\"token string\">'time'</span><span class=\"token punctuation\">]</span>\n  d<span class=\"token punctuation\">[</span><span class=\"token string\">'bits'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> block_data<span class=\"token punctuation\">[</span><span class=\"token string\">'bits'</span><span class=\"token punctuation\">]</span>\n  d<span class=\"token punctuation\">[</span><span class=\"token string\">'nonce'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> block_data<span class=\"token punctuation\">[</span><span class=\"token string\">'nonce'</span><span class=\"token punctuation\">]</span>\n  d<span class=\"token punctuation\">[</span><span class=\"token string\">'previousblockhash'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> block_data<span class=\"token punctuation\">[</span><span class=\"token string\">'previousblockhash'</span><span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">return</span> d\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_block_header</span><span class=\"token punctuation\">(</span>block_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  header <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">.</span>to_bytes<span class=\"token punctuation\">(</span>block_data<span class=\"token punctuation\">[</span><span class=\"token string\">'version'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'little'</span><span class=\"token punctuation\">)</span>\n  header <span class=\"token operator\">+=</span> <span class=\"token builtin\">bytes</span><span class=\"token punctuation\">.</span>fromhex<span class=\"token punctuation\">(</span>block_data<span class=\"token punctuation\">[</span><span class=\"token string\">'previousblockhash'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n  header <span class=\"token operator\">+=</span> <span class=\"token builtin\">bytes</span><span class=\"token punctuation\">.</span>fromhex<span class=\"token punctuation\">(</span>block_data<span class=\"token punctuation\">[</span><span class=\"token string\">'merkleroot'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n  header <span class=\"token operator\">+=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">.</span>to_bytes<span class=\"token punctuation\">(</span>block_data<span class=\"token punctuation\">[</span><span class=\"token string\">'time'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'little'</span><span class=\"token punctuation\">)</span>\n  header <span class=\"token operator\">+=</span> <span class=\"token builtin\">bytes</span><span class=\"token punctuation\">.</span>fromhex<span class=\"token punctuation\">(</span>block_data<span class=\"token punctuation\">[</span><span class=\"token string\">'bits'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n  header <span class=\"token operator\">+=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">.</span>to_bytes<span class=\"token punctuation\">(</span>block_data<span class=\"token punctuation\">[</span><span class=\"token string\">'nonce'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'little'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> header\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">check_block</span><span class=\"token punctuation\">(</span>header<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token comment\"># checks if the block satisfies the condition</span>\n  <span class=\"token comment\"># isPrime(sha256(h-2) + sha256(h-1)) where h</span>\n  <span class=\"token comment\"># is the sha256 hash of the block header</span>\n  h <span class=\"token operator\">=</span> bytes_to_long<span class=\"token punctuation\">(</span>sha256<span class=\"token punctuation\">(</span>header<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>digest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  p <span class=\"token operator\">=</span> sha256<span class=\"token punctuation\">(</span>long_to_bytes<span class=\"token punctuation\">(</span>h<span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>digest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> sha256<span class=\"token punctuation\">(</span>long_to_bytes<span class=\"token punctuation\">(</span>h<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>digest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  p <span class=\"token operator\">=</span> bytes_to_long<span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> isPrime<span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">go</span><span class=\"token punctuation\">(</span>block_date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  block_list<span class=\"token punctuation\">,</span> block_date <span class=\"token operator\">=</span> get_blocks_list<span class=\"token punctuation\">(</span>block_date<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">for</span> block_hash <span class=\"token keyword\">in</span> tqdm<span class=\"token punctuation\">(</span>block_list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    block_data <span class=\"token operator\">=</span> get_block_data<span class=\"token punctuation\">(</span>block_hash<span class=\"token punctuation\">)</span>\n    header <span class=\"token operator\">=</span> get_block_header<span class=\"token punctuation\">(</span>block_data<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> check_block<span class=\"token punctuation\">(</span>header<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n      <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[+] found block:'</span><span class=\"token punctuation\">,</span> block_hash<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">' |  use seed'</span><span class=\"token punctuation\">,</span> long_to_bytes<span class=\"token punctuation\">(</span>bytes_to_long<span class=\"token punctuation\">(</span>sha256<span class=\"token punctuation\">(</span>header<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>digest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">hex</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">return</span> <span class=\"token boolean\">True</span>\n  <span class=\"token keyword\">return</span> go<span class=\"token punctuation\">(</span>block_date<span class=\"token punctuation\">)</span>\n\ngo<span class=\"token punctuation\">(</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># [+] found block: 000000000000000003cf4d4204d2a2f1fa76e32ae8f4f911c4c630ffd5f50a8f</span>\n<span class=\"token comment\">#  |  use seed 54fb3cbca5ab07e88926a4aa936e7cdff6f3ce64b6645cea511681a661c6240a</span></code></pre></div>\n<p>Grabbing the flag:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> pwn <span class=\"token keyword\">import</span> remote<span class=\"token punctuation\">,</span> process\n<span class=\"token keyword\">from</span> Crypto<span class=\"token punctuation\">.</span>Util<span class=\"token punctuation\">.</span>number <span class=\"token keyword\">import</span> long_to_bytes<span class=\"token punctuation\">,</span> bytes_to_long<span class=\"token punctuation\">,</span> isPrime\n<span class=\"token keyword\">from</span> Crypto<span class=\"token punctuation\">.</span>Util<span class=\"token punctuation\">.</span>strxor <span class=\"token keyword\">import</span> strxor\n<span class=\"token keyword\">from</span> Crypto<span class=\"token punctuation\">.</span>Cipher <span class=\"token keyword\">import</span> AES\n<span class=\"token keyword\">from</span> base64 <span class=\"token keyword\">import</span> b64encode<span class=\"token punctuation\">,</span> b64decode\n<span class=\"token keyword\">import</span> subprocess\n<span class=\"token keyword\">import</span> hashlib\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># return process('./task.py')</span>\n    <span class=\"token keyword\">return</span> remote<span class=\"token punctuation\">(</span><span class=\"token string\">'bitflip2.hackable.software'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1337</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">recv</span><span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    o <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span>recvline<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[&lt;]'</span><span class=\"token punctuation\">,</span> o<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> o\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">send</span><span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[>]'</span><span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">)</span>\n    conn<span class=\"token punctuation\">.</span>sendline<span class=\"token punctuation\">(</span>d<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">solve_pow</span><span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    challenge <span class=\"token operator\">=</span> recv<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n    stamp <span class=\"token operator\">=</span> subprocess<span class=\"token punctuation\">.</span>check_output<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'hashcash'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-mb28'</span><span class=\"token punctuation\">,</span> challenge<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    send<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> stamp<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">do_round</span><span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    recv<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span>\n    x <span class=\"token operator\">=</span> b64encode<span class=\"token punctuation\">(</span>long_to_bytes<span class=\"token punctuation\">(</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    send<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># iters = int(recv(conn).split(' ')[-1])</span>\n    iters <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>recv<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">'after '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    iv <span class=\"token operator\">=</span> b64decode<span class=\"token punctuation\">(</span>recv<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    ct <span class=\"token operator\">=</span> b64decode<span class=\"token punctuation\">(</span>recv<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> iters<span class=\"token punctuation\">,</span> iv<span class=\"token punctuation\">,</span> ct\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">num_iters</span><span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> do_round<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">flip</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># x is a bit string</span>\n    <span class=\"token keyword\">return</span> x<span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">'0'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'x'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'0'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">'x'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">)</span>\n\nconn <span class=\"token operator\">=</span> connect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nsolve_pow<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span>\n\nalice_seed <span class=\"token operator\">=</span> <span class=\"token string\">'0'</span>\nt <span class=\"token operator\">=</span> num_iters<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> <span class=\"token string\">'0'</span><span class=\"token punctuation\">)</span>\nt2 <span class=\"token operator\">=</span> num_iters<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> <span class=\"token string\">'10'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> t2 <span class=\"token operator\">==</span> t <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n    alice_seed <span class=\"token operator\">=</span> <span class=\"token string\">'00'</span>\n<span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n    alice_seed <span class=\"token operator\">=</span> <span class=\"token string\">'10'</span>\n\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">126</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    f <span class=\"token operator\">=</span> flip<span class=\"token punctuation\">(</span>alice_seed<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'0'</span>\n    A <span class=\"token operator\">=</span> num_iters<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> f<span class=\"token punctuation\">)</span>\n    B <span class=\"token operator\">=</span> num_iters<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> <span class=\"token string\">'1'</span><span class=\"token operator\">+</span>f<span class=\"token punctuation\">)</span>\n    C <span class=\"token operator\">=</span> num_iters<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> alice_seed<span class=\"token punctuation\">)</span>\n    D <span class=\"token operator\">=</span> num_iters<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> <span class=\"token string\">'1'</span><span class=\"token operator\">+</span>alice_seed<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> A <span class=\"token operator\">-</span> D <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token keyword\">or</span> B <span class=\"token operator\">-</span> C <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n        alice_seed <span class=\"token operator\">=</span> <span class=\"token string\">'1'</span> <span class=\"token operator\">+</span> alice_seed\n    <span class=\"token keyword\">elif</span> A <span class=\"token operator\">-</span> D <span class=\"token operator\">==</span> <span class=\"token number\">1</span> <span class=\"token keyword\">or</span> B <span class=\"token operator\">-</span> C <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n        alice_seed <span class=\"token operator\">=</span> <span class=\"token string\">'0'</span> <span class=\"token operator\">+</span> alice_seed\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[!] unexpected branch'</span><span class=\"token punctuation\">)</span>\n        exit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[+] alice_seed:'</span><span class=\"token punctuation\">,</span> alice_seed<span class=\"token punctuation\">)</span>\n\ntarget_seed <span class=\"token operator\">=</span> <span class=\"token builtin\">bytes</span><span class=\"token punctuation\">.</span>fromhex<span class=\"token punctuation\">(</span><span class=\"token string\">'54fb3cbca5ab07e88926a4aa936e7cdff6f3ce64b6645cea511681a661c6240a'</span><span class=\"token punctuation\">)</span>\ns <span class=\"token operator\">=</span> strxor<span class=\"token punctuation\">(</span>target_seed<span class=\"token punctuation\">,</span> long_to_bytes<span class=\"token punctuation\">(</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>alice_seed<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n_<span class=\"token punctuation\">,</span> iv<span class=\"token punctuation\">,</span> ct <span class=\"token operator\">=</span> do_round<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> <span class=\"token builtin\">bin</span><span class=\"token punctuation\">(</span>bytes_to_long<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\nshared <span class=\"token operator\">=</span> <span class=\"token number\">1336</span>\ncipher <span class=\"token operator\">=</span> AES<span class=\"token punctuation\">.</span>new<span class=\"token punctuation\">(</span>long_to_bytes<span class=\"token punctuation\">(</span>shared<span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">16</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> AES<span class=\"token punctuation\">.</span>MODE_CBC<span class=\"token punctuation\">,</span> IV<span class=\"token operator\">=</span>iv<span class=\"token punctuation\">)</span>\nflag <span class=\"token operator\">=</span> cipher<span class=\"token punctuation\">.</span>decrypt<span class=\"token punctuation\">(</span>ct<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[+] FLAG:'</span><span class=\"token punctuation\">,</span> flag<span class=\"token punctuation\">)</span>\n\nconn<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Flag: <code>DrgnS{B1tc0in_p0w3r_crypt0_brut3}</code></p>\n<h1>Bit Flip 3 <a name=\"bit-flip-3\"></a></h1>\n<blockquote>\n<p>Flip bits and decrypt communication between Bob and Alice, but this time Bob is not so talkative and primes are stronger.</p>\n<p>nc bitflip3.hackable.software 1337</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\">#!/usr/bin/python3</span>\n\n<span class=\"token keyword\">from</span> Crypto<span class=\"token punctuation\">.</span>Util<span class=\"token punctuation\">.</span>number <span class=\"token keyword\">import</span> bytes_to_long<span class=\"token punctuation\">,</span> long_to_bytes\n<span class=\"token keyword\">from</span> Crypto<span class=\"token punctuation\">.</span>Cipher <span class=\"token keyword\">import</span> AES\n<span class=\"token keyword\">import</span> hashlib\n<span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">import</span> base64\n<span class=\"token keyword\">from</span> gmpy2 <span class=\"token keyword\">import</span> is_prime\n\nFLAG <span class=\"token operator\">=</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"flag\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"rb\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nFLAG <span class=\"token operator\">+=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">16</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>FLAG<span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token string\">b\" \"</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Rng</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> seed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    self<span class=\"token punctuation\">.</span>seed <span class=\"token operator\">=</span> seed\n    self<span class=\"token punctuation\">.</span>generated <span class=\"token operator\">=</span> <span class=\"token string\">b\"\"</span>\n    self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token function\">more_bytes</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    self<span class=\"token punctuation\">.</span>generated <span class=\"token operator\">+=</span> hashlib<span class=\"token punctuation\">.</span>sha256<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>seed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>digest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    self<span class=\"token punctuation\">.</span>seed <span class=\"token operator\">=</span> long_to_bytes<span class=\"token punctuation\">(</span>bytes_to_long<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>seed<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">)</span>\n    self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">+=</span> <span class=\"token number\">256</span>\n\n\n  <span class=\"token keyword\">def</span> <span class=\"token function\">getbits</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> num<span class=\"token operator\">=</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">&lt;</span> num<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n      self<span class=\"token punctuation\">.</span>more_bytes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    x <span class=\"token operator\">=</span> bytes_to_long<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>generated<span class=\"token punctuation\">)</span>\n    self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">-=</span> num\n    self<span class=\"token punctuation\">.</span>generated <span class=\"token operator\">=</span> <span class=\"token string\">b\"\"</span>\n    <span class=\"token keyword\">if</span> self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n      self<span class=\"token punctuation\">.</span>generated <span class=\"token operator\">=</span> long_to_bytes<span class=\"token punctuation\">(</span>x <span class=\"token operator\">>></span> num<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>num <span class=\"token operator\">//</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> x <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">&lt;&lt;</span> num<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">DiffieHellman</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">def</span> <span class=\"token function\">gen_strong_prime</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    prime <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>rng<span class=\"token punctuation\">.</span>getbits<span class=\"token punctuation\">(</span><span class=\"token number\">512</span><span class=\"token punctuation\">)</span>\n    <span class=\"token builtin\">iter</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    strong_prime <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token operator\">*</span>prime<span class=\"token operator\">+</span><span class=\"token number\">1</span>\n    <span class=\"token keyword\">while</span> <span class=\"token keyword\">not</span> <span class=\"token punctuation\">(</span>prime <span class=\"token operator\">%</span> <span class=\"token number\">5</span> <span class=\"token operator\">==</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">not</span> is_prime<span class=\"token punctuation\">(</span>prime<span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">not</span> is_prime<span class=\"token punctuation\">(</span>strong_prime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n      <span class=\"token builtin\">iter</span> <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n      prime <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>rng<span class=\"token punctuation\">.</span>getbits<span class=\"token punctuation\">(</span><span class=\"token number\">512</span><span class=\"token punctuation\">)</span>\n      strong_prime <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token operator\">*</span>prime<span class=\"token operator\">+</span><span class=\"token number\">1</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Generated after\"</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">iter</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"iterations\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> strong_prime\n\n  <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> seed<span class=\"token punctuation\">,</span> prime<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    self<span class=\"token punctuation\">.</span>rng <span class=\"token operator\">=</span> Rng<span class=\"token punctuation\">(</span>seed<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> prime <span class=\"token keyword\">is</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n      prime <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>gen_strong_prime<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    self<span class=\"token punctuation\">.</span>prime <span class=\"token operator\">=</span> prime\n    self<span class=\"token punctuation\">.</span>my_secret <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>rng<span class=\"token punctuation\">.</span>getbits<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    self<span class=\"token punctuation\">.</span>my_number <span class=\"token operator\">=</span> <span class=\"token builtin\">pow</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>my_secret<span class=\"token punctuation\">,</span> prime<span class=\"token punctuation\">)</span>\n    self<span class=\"token punctuation\">.</span>shared <span class=\"token operator\">=</span> <span class=\"token number\">1337</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token function\">set_other</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    self<span class=\"token punctuation\">.</span>shared <span class=\"token operator\">^</span><span class=\"token operator\">=</span> <span class=\"token builtin\">pow</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>my_secret<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>prime<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">pad32</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token string\">b\"\\x00\"</span><span class=\"token operator\">*</span><span class=\"token number\">32</span><span class=\"token operator\">+</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">32</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">xor32</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">return</span> <span class=\"token builtin\">bytes</span><span class=\"token punctuation\">(</span>x<span class=\"token operator\">^</span>y <span class=\"token keyword\">for</span> x<span class=\"token punctuation\">,</span> y <span class=\"token keyword\">in</span> <span class=\"token builtin\">zip</span><span class=\"token punctuation\">(</span>pad32<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> pad32<span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">bit_flip</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bit-flip str:\"</span><span class=\"token punctuation\">)</span>\n  flip_str <span class=\"token operator\">=</span> base64<span class=\"token punctuation\">.</span>b64decode<span class=\"token punctuation\">(</span><span class=\"token builtin\">input</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> xor32<span class=\"token punctuation\">(</span>flip_str<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span>\n\n\nalice_seed <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>urandom<span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">while</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n  alice <span class=\"token operator\">=</span> DiffieHellman<span class=\"token punctuation\">(</span>bit_flip<span class=\"token punctuation\">(</span>alice_seed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  bob <span class=\"token operator\">=</span> DiffieHellman<span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">.</span>urandom<span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> alice<span class=\"token punctuation\">.</span>prime<span class=\"token punctuation\">)</span>\n\n  alice<span class=\"token punctuation\">.</span>set_other<span class=\"token punctuation\">(</span>bob<span class=\"token punctuation\">.</span>my_number<span class=\"token punctuation\">)</span>\n  <span class=\"token comment\"># print(\"bob number\", long_to_bytes(bob.my_number))</span>\n  bob<span class=\"token punctuation\">.</span>set_other<span class=\"token punctuation\">(</span>alice<span class=\"token punctuation\">.</span>my_number<span class=\"token punctuation\">)</span>\n  iv <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>urandom<span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>base64<span class=\"token punctuation\">.</span>b64encode<span class=\"token punctuation\">(</span>iv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  cipher <span class=\"token operator\">=</span> AES<span class=\"token punctuation\">.</span>new<span class=\"token punctuation\">(</span>long_to_bytes<span class=\"token punctuation\">(</span>alice<span class=\"token punctuation\">.</span>shared<span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">16</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> AES<span class=\"token punctuation\">.</span>MODE_CBC<span class=\"token punctuation\">,</span> IV<span class=\"token operator\">=</span>iv<span class=\"token punctuation\">)</span>\n  enc_flag <span class=\"token operator\">=</span> cipher<span class=\"token punctuation\">.</span>encrypt<span class=\"token punctuation\">(</span>FLAG<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>base64<span class=\"token punctuation\">.</span>b64encode<span class=\"token punctuation\">(</span>enc_flag<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Solution</h2>\n<p>I didn't manage to solve this one during the CTF either. It is a deceptively easy challenge though.</p>\n<p>This handout code is identical to <code>Bit Flip 2</code>, except the primes generated are strong primes:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">❯ <span class=\"token function\">diff</span> task-2.py  task-3.py\n38c38\n<span class=\"token operator\">&lt;</span>   def gen_prime<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span>:\n---\n<span class=\"token operator\">></span>   def gen_strong_prime<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span>:\n41c41,42\n<span class=\"token operator\">&lt;</span>     <span class=\"token keyword\">while</span> not is_prime<span class=\"token punctuation\">(</span>prime<span class=\"token punctuation\">)</span>:\n---\n<span class=\"token operator\">></span>     strong_prime <span class=\"token operator\">=</span> <span class=\"token number\">2</span>*prime+1\n<span class=\"token operator\">></span>     <span class=\"token keyword\">while</span> not <span class=\"token punctuation\">(</span>prime % <span class=\"token number\">5</span> <span class=\"token operator\">==</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> or not is_prime<span class=\"token punctuation\">(</span>prime<span class=\"token punctuation\">)</span> or not is_prime<span class=\"token punctuation\">(</span>strong_prime<span class=\"token punctuation\">)</span>:\n43a45\n<span class=\"token operator\">></span>       strong_prime <span class=\"token operator\">=</span> <span class=\"token number\">2</span>*prime+1\n45c47\n<span class=\"token operator\">&lt;</span>     <span class=\"token builtin class-name\">return</span> prime\n---\n<span class=\"token operator\">></span>     <span class=\"token builtin class-name\">return</span> strong_prime\n50c52\n<span class=\"token operator\">&lt;</span>       prime <span class=\"token operator\">=</span> self.gen_prime<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n---\n<span class=\"token operator\">></span>       prime <span class=\"token operator\">=</span> self.gen_strong_prime<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Taking a look at the prime generation method:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">  <span class=\"token keyword\">def</span> <span class=\"token function\">gen_strong_prime</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    prime <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>rng<span class=\"token punctuation\">.</span>getbits<span class=\"token punctuation\">(</span><span class=\"token number\">512</span><span class=\"token punctuation\">)</span>\n    <span class=\"token builtin\">iter</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    strong_prime <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token operator\">*</span>prime<span class=\"token operator\">+</span><span class=\"token number\">1</span>\n    <span class=\"token keyword\">while</span> <span class=\"token keyword\">not</span> <span class=\"token punctuation\">(</span>prime <span class=\"token operator\">%</span> <span class=\"token number\">5</span> <span class=\"token operator\">==</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">not</span> is_prime<span class=\"token punctuation\">(</span>prime<span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">not</span> is_prime<span class=\"token punctuation\">(</span>strong_prime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n      <span class=\"token builtin\">iter</span> <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n      prime <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>rng<span class=\"token punctuation\">.</span>getbits<span class=\"token punctuation\">(</span><span class=\"token number\">512</span><span class=\"token punctuation\">)</span>\n      strong_prime <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token operator\">*</span>prime<span class=\"token operator\">+</span><span class=\"token number\">1</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Generated after\"</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">iter</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"iterations\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> strong_prime</code></pre></div>\n<p>we see that <code>prime</code> is up to 512 bits, so <code>strong_prime = 2*prime+1</code> is potentially 513 bits. If we look at the encryption of the flag:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">  cipher <span class=\"token operator\">=</span> AES<span class=\"token punctuation\">.</span>new<span class=\"token punctuation\">(</span>long_to_bytes<span class=\"token punctuation\">(</span>alice<span class=\"token punctuation\">.</span>shared<span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">16</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> AES<span class=\"token punctuation\">.</span>MODE_CBC<span class=\"token punctuation\">,</span> IV<span class=\"token operator\">=</span>iv<span class=\"token punctuation\">)</span></code></pre></div>\n<p>we see that <code>long_to_bytes</code> is called with <code>blocksize=16</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">>>> help(long_to_bytes)\nHelp on function long_to_bytes in module Crypto.Util.number:\n\nlong_to_bytes(n, blocksize=0)\n    Convert an integer to a byte string.\n\n    In Python 3.2+, use the native method instead::\n\n        >>> n.to_bytes(blocksize, 'big')\n\n    For instance::\n\n        >>> n = 80\n        >>> n.to_bytes(2, 'big')\n        b'P'\n\n    If the optional :data:`blocksize` is provided and greater than zero,\n    the byte string is padded with binary zeros (on the front) so that\n    the total length of the output is a multiple of blocksize.\n\n    If :data:`blocksize` is zero or not provided, the byte string will\n    be of minimal length.</code></pre></div>\n<p>So the call to <code>long_to_bytes(alice.shared, 16)</code> (where we assume <code>alice.shared</code> is 513 bits since the prime is) will pad the output such that the first 16 bytes at <code>\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x01</code>.</p>\n<p>To get the flag, all we need to do is attempt to decrypt the given ciphertexts with the key <code>\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x01</code>. After a few attempts, we'll get the flag.</p>\n<p><strong>Solve script:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> pwn <span class=\"token keyword\">import</span> remote<span class=\"token punctuation\">,</span> process\n<span class=\"token keyword\">from</span> Crypto<span class=\"token punctuation\">.</span>Cipher <span class=\"token keyword\">import</span> AES\n<span class=\"token keyword\">from</span> Crypto<span class=\"token punctuation\">.</span>Util<span class=\"token punctuation\">.</span>number <span class=\"token keyword\">import</span> long_to_bytes\n<span class=\"token keyword\">from</span> base64 <span class=\"token keyword\">import</span> b64encode<span class=\"token punctuation\">,</span> b64decode\n<span class=\"token keyword\">import</span> subprocess\n<span class=\"token keyword\">import</span> hashlib\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># return process('./task.py')</span>\n    <span class=\"token keyword\">return</span> remote<span class=\"token punctuation\">(</span><span class=\"token string\">'bitflip3.hackable.software'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1337</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">recv</span><span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    o <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span>recvline<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[&lt;]'</span><span class=\"token punctuation\">,</span> o<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> o\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">send</span><span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[>]'</span><span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">)</span>\n    conn<span class=\"token punctuation\">.</span>sendline<span class=\"token punctuation\">(</span>d<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">solve_pow</span><span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    challenge <span class=\"token operator\">=</span> recv<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n    stamp <span class=\"token operator\">=</span> subprocess<span class=\"token punctuation\">.</span>check_output<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'hashcash'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-mb28'</span><span class=\"token punctuation\">,</span> challenge<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    send<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> stamp<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">do_round</span><span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    recv<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span>\n    x <span class=\"token operator\">=</span> b64encode<span class=\"token punctuation\">(</span>long_to_bytes<span class=\"token punctuation\">(</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    send<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># iters = int(recv(conn).split(' ')[-1])</span>\n    iters <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>recv<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">'after '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    iv <span class=\"token operator\">=</span> b64decode<span class=\"token punctuation\">(</span>recv<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    ct <span class=\"token operator\">=</span> b64decode<span class=\"token punctuation\">(</span>recv<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> iters<span class=\"token punctuation\">,</span> iv<span class=\"token punctuation\">,</span> ct\n\nconn <span class=\"token operator\">=</span> connect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nsolve_pow<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span>\n\ni <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">while</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n    _<span class=\"token punctuation\">,</span> iv<span class=\"token punctuation\">,</span> ct <span class=\"token operator\">=</span> do_round<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> <span class=\"token string\">'1'</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">+</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    cipher <span class=\"token operator\">=</span> AES<span class=\"token punctuation\">.</span>new<span class=\"token punctuation\">(</span><span class=\"token string\">b'\\x00'</span><span class=\"token operator\">*</span><span class=\"token number\">15</span> <span class=\"token operator\">+</span> <span class=\"token string\">b'\\x01'</span><span class=\"token punctuation\">,</span> AES<span class=\"token punctuation\">.</span>MODE_CBC<span class=\"token punctuation\">,</span> IV<span class=\"token operator\">=</span>iv<span class=\"token punctuation\">)</span>\n    flag <span class=\"token operator\">=</span> cipher<span class=\"token punctuation\">.</span>decrypt<span class=\"token punctuation\">(</span>ct<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token string\">b'Drgn'</span> <span class=\"token keyword\">in</span> flag<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[+] FLAG:'</span><span class=\"token punctuation\">,</span> flag<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">break</span>\n    i <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n\nconn<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Flag: <code>DrgnS{C0nst_A3S_K3y_1111111111111!}</code></p>","frontmatter":{"date":"November 23, 2020","path":"/posts/2020-11-23-dragon-ctf-2020-bit-flip-writeups","title":"Dragon CTF 2020 - Bit Flip","tags":"ctf,infosec,writeup,crypto"}}},"pageContext":{"prev":{"fileAbsolutePath":"/media/winarch-shared/code/portfolio/src/posts/2020-10-12-seccon-2020-ctf-writeups/index.md","frontmatter":{"title":"SECCON 2020 CTF Writeups","date":"2020-10-12T00:00:00.000Z","path":"/posts/2020-10-12-seccon-2020-ctf"}},"next":{"fileAbsolutePath":"/media/winarch-shared/code/portfolio/src/posts/2020-11-30-hitcon-ctf-2020-100-pins-writeup/index.md","frontmatter":{"title":"HITCON CTF 2020 - 100 Pins","date":"2020-11-30T00:00:00.000Z","path":"/posts/2020-11-30-hitcon-ctf-2020-100-pins-writeup"}}}},
    "staticQueryHashes": ["4146750380"]}