{
    "componentChunkName": "component---src-templates-md-blog-post-js",
    "path": "/posts/2020-11-30-hitcon-ctf-2020-100-pins-writeup",
    "result": {"data":{"markdownRemark":{"html":"<p>This was the most solved crypto challenge, but was still pretty difficult. It had 8 solves by the end of the CTF. I couldn't have solved it without the help of my teammates.</p>\n<h1>100 Pins (HITCON CTF 2020)</h1>\n<blockquote>\n<p>4 digits pin are too weak... How about 100 of them?</p>\n<p><code>nc 18.183.134.249 1234</code></p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token hashbang comment\">#!/usr/bin/env node</span>\n\n<span class=\"token keyword\">const</span> rl <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"readline\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">createInterface</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  input<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>stdin<span class=\"token punctuation\">,</span>\n  output<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nrl<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"close\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">yellow</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Bye\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  process<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">ask</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">q</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> rl<span class=\"token punctuation\">.</span><span class=\"token function\">question</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">s</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">colorLog</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">c</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span>args</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\\x1b[1;</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>c<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">m</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span> args<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\x1b[0m\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> red <span class=\"token operator\">=</span> <span class=\"token function\">colorLog</span><span class=\"token punctuation\">(</span><span class=\"token number\">31</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> green <span class=\"token operator\">=</span> <span class=\"token function\">colorLog</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> yellow <span class=\"token operator\">=</span> <span class=\"token function\">colorLog</span><span class=\"token punctuation\">(</span><span class=\"token number\">33</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> info <span class=\"token operator\">=</span> <span class=\"token function\">colorLog</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> flag <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">[</span><span class=\"token string\">\"FLAG\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>flag <span class=\"token operator\">===</span> <span class=\"token keyword\">undefined</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>flag<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hitcon\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">red</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Oops... missing flag, please contact admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  process<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">red</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Too sloooooooooooow :(\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  process<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">180</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">N</span> <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> candidates <span class=\"token operator\">=</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> length<span class=\"token operator\">:</span> <span class=\"token number\">10000</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">_<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  i<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">padStart</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"0\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>size <span class=\"token operator\">===</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> pins <span class=\"token operator\">=</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">{</span> length<span class=\"token operator\">:</span> <span class=\"token constant\">N</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> candidates<span class=\"token punctuation\">[</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> candidates<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">match</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">pin<span class=\"token punctuation\">,</span> s</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> a <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> b <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> s<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> j <span class=\"token operator\">=</span> pin<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>j <span class=\"token operator\">===</span> i<span class=\"token punctuation\">)</span> a<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>j <span class=\"token operator\">!==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> b<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">sha256</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">s</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"crypto\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">createHash</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sha256\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">digest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hex\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">pow</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> nonce <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token number\">36</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> s <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">ask</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Show me sha256(\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>nonce<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\" + s) ends with \"00000\": </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> hash <span class=\"token operator\">=</span> <span class=\"token function\">sha256</span><span class=\"token punctuation\">(</span>nonce <span class=\"token operator\">+</span> s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>hash<span class=\"token punctuation\">.</span><span class=\"token function\">endsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"00000\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">red</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Huh?\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    process<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">main</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">green</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Welcome to FLAG locker </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>process<span class=\"token punctuation\">.</span>version<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">pow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">=== FLAG is locked with </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">N</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> pins ===</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> rem <span class=\"token operator\">=</span> <span class=\"token number\">128</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token constant\">N</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">--</span>rem <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">red</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Too many errors! Device is wiped and the flag is gone ¯\\\\_(ツ)_/¯\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      process<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> pin <span class=\"token operator\">=</span> pins<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> s <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">ask</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Pin </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">? </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">match</span><span class=\"token punctuation\">(</span>pin<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>a <span class=\"token operator\">===</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">green</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"OK\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">yellow</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Hmm... hint: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>a<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">A</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>b<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">B</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    i<span class=\"token operator\">--</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">green</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"FLAG Unlocked:\"</span><span class=\"token punctuation\">,</span> flag<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  process<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">finally</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> process<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Solution</h2>\n<h3>Challenge Overview</h3>\n<p>The server challenges us to guess 100 four digit pins with 128 attempts. The pins have no repeating digits, so there is a total of 5040 possible pins (still impossible to guess).</p>\n<p>When we submit an incorrect pin attempt the server gives us a hint:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Pin 1? 1337\nHmm... hint: 0A2B</code></pre></div>\n<p>In general, the hint is of the form <code>aAbB</code> where</p>\n<ul>\n<li><code>a</code> is the number of exactly matching digits in our guess and in the pin</li>\n<li><code>b</code> is the number of digits in the pin that is in our guess, but not in the correct position</li>\n</ul>\n<p>For example, if the pin is <code>2481</code> and our guess is <code>2984</code>, then <code>a</code> is <code>2</code> and <code>b</code> is <code>1</code>.</p>\n<h3>Analysis</h3>\n<p>The hint given to us each time we submit an attempt is pretty useful, but it should be quite clear that there's no way we'll be able to guess 100 pins with 128 attempts using the hint alone.</p>\n<p>Some peculiar things we noticed was that the script is written in JavaScript and we are given the Node.js version that the server is running. Looking at the generation of the pins:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token constant\">N</span> <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> candidates <span class=\"token operator\">=</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> length<span class=\"token operator\">:</span> <span class=\"token number\">10000</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">_<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  i<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">padStart</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"0\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>size <span class=\"token operator\">===</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> pins <span class=\"token operator\">=</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">{</span> length<span class=\"token operator\">:</span> <span class=\"token constant\">N</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> candidates<span class=\"token punctuation\">[</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> candidates<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>we see that <code>Math.random()</code> is being used. This uses Xorshift128+ under the hood which is not cryptographically secure. At this point, the solution became quite clear; use the hints to somehow guess a few pins, then use this information to recover the state of the Xorshift128+ PRNG, then predict future outputs.</p>\n<p>Seems pretty straightforward... but we came across many issues when implementing, mostly due to the additional constraints (time limit and number of guesses) in the challenge.</p>\n<h3>Part 1: Guessing Pins</h3>\n<p>To recover the state of the PRNG, we need some sample outputs. And to get some sample outputs, we need to determine some of the pins. We can determine the output of the PRNG from the pin by taking the index of the pin in the <code>candidates</code> array.</p>\n<p>This is the function used to generate the hint <code>aAbB</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">match</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">pin<span class=\"token punctuation\">,</span> s</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> a <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> b <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> s<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> j <span class=\"token operator\">=</span> pin<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>j <span class=\"token operator\">===</span> i<span class=\"token punctuation\">)</span> a<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>j <span class=\"token operator\">!==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> b<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Here, <code>s</code> is our input as a string. Notice that <em>all</em> characters of our input is iterated over in the for loop. This means we aren't limited to just a 4 digit guess, and this allows us to learn some additional information about the pin. Specifically, if we send the guess</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">011222233333333(16 times \"4\")(32 times \"5\")(64 times \"6\")(128 times \"7\")(256 times \"8\")(512 times \"9\")</code></pre></div>\n<p>then the server will give us the hint <code>aAbB</code>. If we look at the binary representation of <code>a+b</code> we will notice that the <code>1</code> bits correspond exactly to the digits in the pin! As an example, if the pin was <code>0394</code>, then the hint given by the server will be <code>1A535B</code>. And</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">bin(536) == '0b1000011001'</code></pre></div>\n<p>so we can deduce that the pin contains the digits <code>0</code>, <code>3</code>, <code>4</code> and <code>9</code>.</p>\n<p>Knowing the digits of the pin reduces the possibilities from 5040 to 24. This is a major improvement, but still way too expensive to naively bruteforce. It turns out (from empirical testing) that we need 11 pins to recover the state of the PRNG. So to be able to complete the challenge and submit all 100 pins, we will need to gather the first 11 pins using <strong>no more than 39</strong> attempts (since we will need to use the remaining 89 attempts to submit the rest of the pins).</p>\n<p>This turned out to be the hardest part of the challenge (imo) and it was solved by a teammate. We started out with an average of 50 attempts to recover the 11 pins and spent hours trying to reduce it as much as we could. The following code (written by hashkitten) is used to recover the pin using approximately <code>3.81567</code> attempts on average, so about 42 attempts to recover the 11 pins. This was just enough for the challenge constraints.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> itertools <span class=\"token keyword\">import</span> permutations<span class=\"token punctuation\">,</span> product\n<span class=\"token keyword\">from</span> math <span class=\"token keyword\">import</span> log2\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">match</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span>x<span class=\"token operator\">==</span>y <span class=\"token keyword\">for</span> x<span class=\"token punctuation\">,</span>y <span class=\"token keyword\">in</span> <span class=\"token builtin\">zip</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">check</span><span class=\"token punctuation\">(</span>guess<span class=\"token punctuation\">,</span> possibilities<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    l <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> possibilities<span class=\"token punctuation\">:</span>\n        l<span class=\"token punctuation\">[</span><span class=\"token string\">''</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> match<span class=\"token punctuation\">(</span>guess<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span>\n    nl <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        nl<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>v <span class=\"token keyword\">for</span> v <span class=\"token keyword\">in</span> l <span class=\"token keyword\">if</span> l<span class=\"token punctuation\">[</span>v<span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> i<span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">return</span> nl\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">entropy</span><span class=\"token punctuation\">(</span>nl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    tot <span class=\"token operator\">=</span> <span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> nl<span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    ent <span class=\"token operator\">=</span> <span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token operator\">/</span>tot<span class=\"token punctuation\">)</span><span class=\"token operator\">*</span>log2<span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token operator\">/</span>tot<span class=\"token punctuation\">)</span> <span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token keyword\">else</span> <span class=\"token number\">0</span> <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> nl<span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> ent\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">check_entropy</span><span class=\"token punctuation\">(</span>guess<span class=\"token punctuation\">,</span> possibilities<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> entropy<span class=\"token punctuation\">(</span>check<span class=\"token punctuation\">(</span>guess<span class=\"token punctuation\">,</span> possibilities<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_pin</span><span class=\"token punctuation\">(</span>digit_string<span class=\"token punctuation\">,</span> blackbox<span class=\"token punctuation\">,</span> fnum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    first_guess <span class=\"token operator\">=</span> <span class=\"token string\">'1234'</span>\n    possibilities <span class=\"token operator\">=</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span>permutations<span class=\"token punctuation\">(</span>digit_string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    possibilities <span class=\"token operator\">=</span> check<span class=\"token punctuation\">(</span>first_guess<span class=\"token punctuation\">,</span> possibilities<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>fnum<span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n        lls <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">for</span> possible_guess <span class=\"token keyword\">in</span> product<span class=\"token punctuation\">(</span>digit_string<span class=\"token punctuation\">,</span> repeat<span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            possible_guess <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>possible_guess<span class=\"token punctuation\">)</span>\n            lls<span class=\"token punctuation\">[</span>possible_guess<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> check_entropy<span class=\"token punctuation\">(</span>possible_guess<span class=\"token punctuation\">,</span> possibilities<span class=\"token punctuation\">)</span>\n        best_guess<span class=\"token punctuation\">,</span> ent <span class=\"token operator\">=</span> <span class=\"token builtin\">max</span><span class=\"token punctuation\">(</span>lls<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> key<span class=\"token operator\">=</span><span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span>x<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token number\">100</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">in</span> possibilities<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># print('Guessing {} with entropy {}'.format(best_guess, ent))</span>\n        num <span class=\"token operator\">=</span> blackbox<span class=\"token punctuation\">(</span>best_guess<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> num <span class=\"token operator\">==</span> <span class=\"token number\">4</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> best_guess\n        possibilities <span class=\"token operator\">=</span> check<span class=\"token punctuation\">(</span>best_guess<span class=\"token punctuation\">,</span> possibilities<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>num<span class=\"token punctuation\">]</span>\n        <span class=\"token comment\"># print('Remaining possibilities: {}'.format(possibilities))</span>\n        <span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>possibilities<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">assert</span> blackbox<span class=\"token punctuation\">(</span>possibilities<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">4</span>\n            <span class=\"token keyword\">return</span> possibilities<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n\nperf_count <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_avg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">for</span> p <span class=\"token keyword\">in</span> permutations<span class=\"token punctuation\">(</span><span class=\"token string\">'0123456789'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n        <span class=\"token keyword\">def</span> <span class=\"token function\">test_blackbox</span><span class=\"token punctuation\">(</span>guess<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">global</span> perf_count\n            perf_count <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n            <span class=\"token keyword\">return</span> match<span class=\"token punctuation\">(</span>guess<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">)</span>\n\n        digit_string <span class=\"token operator\">=</span> <span class=\"token builtin\">sorted</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span>\n        fnum <span class=\"token operator\">=</span> test_blackbox<span class=\"token punctuation\">(</span><span class=\"token string\">'1234'</span><span class=\"token punctuation\">)</span>\n        get_pin<span class=\"token punctuation\">(</span>digit_string<span class=\"token punctuation\">,</span> test_blackbox<span class=\"token punctuation\">,</span> fnum<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">global</span> perf_count\n    <span class=\"token keyword\">return</span> perf_count<span class=\"token operator\">/</span><span class=\"token number\">5040</span>\n\n<span class=\"token comment\"># for checking average requests per pin</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>get_avg<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 3.815674603174603</span></code></pre></div>\n<p>To summarise the algorithm, we consider all possible guesses that can be made and for each guess, we look at the number of matches between the guess and the 24 possible pins. To narrow down the possibilities, we take the guess that yields the highest entropy (of the number of possibilities that have a certain number of matches between the guess and the remaining possible pins).</p>\n<p>Before we arrived at this solution, we used the first attempt to figure out the digits in the pin and nothing else (as described at the beginning of this section). We weren't able to get the total number of attempts low enough by doing this. By using <code>\"1234\"+\"01222...\"</code> as the first guess, we were able to get a bit more information about the positions of the digits (some of the time), as well as which digits are in the pin. This helped just enough to reduce the total number of attempts required to recover all 11 pins.</p>\n<h3>Part 2: Recovering Xorshift128+ State</h3>\n<p>After some searching, we quickly found <a href=\"https://security.stackexchange.com/questions/84906/predicting-math-random-numbers\">this stackexchange post</a> which asks pretty much what we need for the challenge. In particular, we can use <a href=\"https://github.com/d0nutptr/v8_rand_buster\">this</a> to recover the state of the PRNG and get previous and future outputs. The author of this also made <a href=\"https://www.youtube.com/watch?v=_Iv6fBrcbAM\">a video</a> which clearly explains how it works.</p>\n<p>An issue we ran into with this was that, in the script linked above, a lot of slow symbolic execution was being used to recover previous outputs of the PRNG once the state has been recovered. It took about ~20s to recover one output so this wouldn't work as the server times out after 180s. Fortunately, it turns out that there is an easy way to reverse the Xorshift128+ algorithm and get previous states, without the slow symbolic execution. This is detailed <a href=\"https://blog.securityevaluators.com/xorshift128-backward-ff3365dc0c17\">here</a> and the relevant code can be found <a href=\"https://github.com/TACIXAT/XorShift128Plus/blob/master/xs128p.py#L57\">here</a>.</p>\n<h3>Part 3: Predicting Next Pins</h3>\n<p>The way <code>Math.random()</code> works is a bit different to what one might expect. When a call to <code>Math.random()</code> is made, V8 checks its \"random cache\". If the cache is populated, it pops a value from it and returns that. Otherwise, it fills the cache with 64 outputs of Xorshift128+. This mechanism allows for faster successive calls to <code>Math.random()</code>. But because the values are popped from the cache, the outputs of <code>Math.random()</code> are in the opposite order of the outputs of the Xorshift128+ PRNG. The image below (taken from <a href=\"https://docs.google.com/presentation/d/1f7yHnskJIl3O9GoZ4u_PHAnISRVaKoDb4V0CMRtNVRI/edit#slide=id.g7c8b89e9a2_0_247\">here</a>) shows this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/69bd424e41ebfc32d0ffed33ed9d5843/e9c9b/random-output.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABx0lEQVQ4y31S2W7jMAzM/3/YLrDJxnBTJ018xPcVybZ8pI9TDFsFbrrYB4IyZY6GM9zM8wzGsiySp2n6DJ7NAH05Q18j+R5ZXxYMbQP1doIOfNxOHoxSn/fjiI1SCm3bomka3G43DMMg0XUdqqJAG8foigKj1hi1wtR16Jta6ipL0fNuGISEAAZBgMvlgvP5LLkoCmitBbTIc+z3e8RxDMOmccRoDOLrFY7jwPM8+c+yI+jGjmvDgt3vd9R1Ddd1kWUZqqrC/f0dSmtEUYQwiiQbYx7shKE92OAPlIDgZVFgt9shSRJpZqRp+k0eC/YY+RmQjMmy73vJvu8LUzZzTEpDCXhmXrOjJBvr6qP4daZZNIZgBObIrFFj6n44HITtc+83wHUmI45IU46eh6osMU+TmEPW1Jbg88qQcc3wAWZHXxZcAx9/f/+C5zjo6lrWZul7ZGEId7tFeDqhbxpMxsiO/hPQXvDlru8RJwnKr3FZp7a+H8B9ecGr56FuGjHwx8jPWhKQINSOrmulxAQ6XpYl0iQRDamvHfsHwzUoX83zHH+2WxyPR4RhKMB2Xez+rnWf/gfIzNfJiCzpOAG4p9zD9aqtez4AwUfP2QuU/2AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"random-output.png\"\n        title=\"random-output.png\"\n        src=\"/static/69bd424e41ebfc32d0ffed33ed9d5843/0a47e/random-output.png\"\n        srcset=\"/static/69bd424e41ebfc32d0ffed33ed9d5843/8a4e8/random-output.png 150w,\n/static/69bd424e41ebfc32d0ffed33ed9d5843/5a46d/random-output.png 300w,\n/static/69bd424e41ebfc32d0ffed33ed9d5843/0a47e/random-output.png 600w,\n/static/69bd424e41ebfc32d0ffed33ed9d5843/e9c9b/random-output.png 627w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Since we've recovered the first 11 outputs of <code>Math.random()</code>, we have <code>Rand_63</code>, <code>Rand_62</code>, ..., <code>Rand_53</code>. So to recover the 12th to 64th outputs of <code>Math.random()</code>, we need to reverse the Xorshift128+ output and recover <code>Rand_52</code>, <code>Rand_51</code>, ..., <code>Rand_0</code>. To get the 65th to 100th outputs of <code>Math.random()</code> we need to get the next outputs of the underlying Xorshift128+ PRNG. Since we are only interested in the next 36 outputs of <code>Math.random()</code>, we'll want to take <code>Rand_127</code>, <code>Rand_126</code>, ... <code>Rand_92</code>. Combining these, we have the indices of all of the remaining pins!</p>\n<p>All that's left is to send the pins to the server to get the flag.</p>\n<p>Since the number of attempts required to recover each pin depends on the pin, we aren't guaranteed to recover the 11 pins in less than 40 attempts every time. However, it happens often enough that we can just manually rerun the script if it fails, and eventually it will work.</p>\n<h3>Solution Scripts</h3>\n<p><code>solv.py</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> xs128p\n<span class=\"token keyword\">from</span> pwn <span class=\"token keyword\">import</span> remote<span class=\"token punctuation\">,</span> process<span class=\"token punctuation\">,</span> context\n<span class=\"token keyword\">import</span> hashlib\n<span class=\"token keyword\">from</span> itertools <span class=\"token keyword\">import</span> permutations\n<span class=\"token keyword\">import</span> string\n<span class=\"token keyword\">from</span> Crypto<span class=\"token punctuation\">.</span>Util<span class=\"token punctuation\">.</span>number <span class=\"token keyword\">import</span> bytes_to_long\n<span class=\"token keyword\">from</span> strip_ansi <span class=\"token keyword\">import</span> strip_ansi\n<span class=\"token keyword\">from</span> get_pin <span class=\"token keyword\">import</span> get_pin\n\ncontext<span class=\"token punctuation\">.</span>log_level <span class=\"token operator\">=</span> <span class=\"token string\">'debug'</span>\n\nBIN_DIGITS <span class=\"token operator\">=</span> <span class=\"token string\">'1234'</span> <span class=\"token operator\">+</span> <span class=\"token string\">'2'</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'0'</span> <span class=\"token operator\">+</span> <span class=\"token string\">'1'</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'3'</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'4'</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'5'</span><span class=\"token operator\">*</span><span class=\"token number\">32</span> <span class=\"token operator\">+</span> <span class=\"token string\">'6'</span><span class=\"token operator\">*</span><span class=\"token number\">64</span> <span class=\"token operator\">+</span> <span class=\"token string\">'7'</span><span class=\"token operator\">*</span><span class=\"token number\">128</span> <span class=\"token operator\">+</span> <span class=\"token string\">'8'</span><span class=\"token operator\">*</span><span class=\"token number\">256</span> <span class=\"token operator\">+</span> <span class=\"token string\">'9'</span><span class=\"token operator\">*</span><span class=\"token number\">512</span>\ncandidates <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>zfill<span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">10000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\ncandidates <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>c <span class=\"token keyword\">for</span> c <span class=\"token keyword\">in</span> candidates <span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">set</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span>\nATTEMPTS <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> remote<span class=\"token punctuation\">(</span><span class=\"token string\">'18.183.134.249'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1234</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># return process('./100pins.js')</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_remaining_idxs</span><span class=\"token punctuation\">(</span>known_idxs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    out1 <span class=\"token operator\">=</span> xs128p<span class=\"token punctuation\">.</span>recover_lead<span class=\"token punctuation\">(</span>known_idxs<span class=\"token punctuation\">,</span> <span class=\"token number\">5040</span><span class=\"token punctuation\">,</span> <span class=\"token number\">64</span><span class=\"token operator\">-</span><span class=\"token number\">12</span><span class=\"token punctuation\">)</span>\n    out2 <span class=\"token operator\">=</span> xs128p<span class=\"token punctuation\">.</span>recover_next<span class=\"token punctuation\">(</span>known_idxs<span class=\"token punctuation\">,</span> <span class=\"token number\">5040</span><span class=\"token punctuation\">,</span> <span class=\"token number\">75</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">36</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">return</span> out1 <span class=\"token operator\">+</span> out2\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">solve_pow</span><span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    goal <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span>recvuntil<span class=\"token punctuation\">(</span><span class=\"token string\">\"ends with \\\"00000\\\":\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">b'sha256(\"'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">b'\" +'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n\n    <span class=\"token keyword\">for</span> s <span class=\"token keyword\">in</span> permutations<span class=\"token punctuation\">(</span>string<span class=\"token punctuation\">.</span>ascii_lowercase<span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        a <span class=\"token operator\">=</span> bytes_to_long<span class=\"token punctuation\">(</span>hashlib<span class=\"token punctuation\">.</span>sha256<span class=\"token punctuation\">(</span>goal <span class=\"token operator\">+</span> <span class=\"token string\">''</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>digest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xfffff</span>\n        <span class=\"token keyword\">if</span> a <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n            conn<span class=\"token punctuation\">.</span>sendline<span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">break</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">send_pin_guess</span><span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> guess<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">global</span> ATTEMPTS\n    ATTEMPTS <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n    conn<span class=\"token punctuation\">.</span>recvuntil<span class=\"token punctuation\">(</span><span class=\"token string\">b'? '</span><span class=\"token punctuation\">)</span>\n    conn<span class=\"token punctuation\">.</span>sendline<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>guess<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># conn.recvline()</span>\n    o <span class=\"token operator\">=</span> strip_ansi<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">.</span>recvline<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token string\">'hint'</span> <span class=\"token keyword\">in</span> o<span class=\"token punctuation\">:</span>\n        x <span class=\"token operator\">=</span> o<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n        a <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">'A'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        b <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">'A'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">'B'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> a<span class=\"token punctuation\">,</span> b\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[+] correct pin!'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">True</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_digits</span><span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    a<span class=\"token punctuation\">,</span>b <span class=\"token operator\">=</span> send_pin_guess<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> BIN_DIGITS<span class=\"token punctuation\">)</span>\n    B <span class=\"token operator\">=</span> a<span class=\"token operator\">+</span>b \n    digits <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> B <span class=\"token operator\">&amp;</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n            digits<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span>\n        B <span class=\"token operator\">>></span><span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">''</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> digits<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> a\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">recover_pin</span><span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">blackbox</span><span class=\"token punctuation\">(</span>guess<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        x <span class=\"token operator\">=</span> send_pin_guess<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> guess<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token number\">4</span> <span class=\"token keyword\">if</span> x <span class=\"token operator\">==</span> <span class=\"token boolean\">True</span> <span class=\"token keyword\">else</span> x<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n    digitstr<span class=\"token punctuation\">,</span> fnum <span class=\"token operator\">=</span> get_digits<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> get_pin<span class=\"token punctuation\">(</span>digitstr<span class=\"token punctuation\">,</span> blackbox<span class=\"token punctuation\">,</span> fnum<span class=\"token punctuation\">)</span>\n    \n<span class=\"token keyword\">def</span> <span class=\"token function\">pin_to_idx</span><span class=\"token punctuation\">(</span>pin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> candidates<span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">(</span>pin<span class=\"token punctuation\">)</span>\n\nconn <span class=\"token operator\">=</span> connect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nsolve_pow<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[+] pow solved'</span><span class=\"token punctuation\">)</span>\n\nknown_idxs <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>pin_to_idx<span class=\"token punctuation\">(</span>recover_pin<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>known_idxs<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[!]'</span><span class=\"token punctuation\">,</span> ATTEMPTS<span class=\"token punctuation\">,</span> <span class=\"token string\">'attempts used to recover state'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> ATTEMPTS <span class=\"token operator\">>=</span> <span class=\"token number\">40</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fail :&lt;'</span><span class=\"token punctuation\">)</span>\n    exit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nnext_pins <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>candidates<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> get_remaining_idxs<span class=\"token punctuation\">(</span>known_idxs<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">for</span> i<span class=\"token punctuation\">,</span> pin <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>next_pins<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    send_pin_guess<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> pin<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>strip_ansi<span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">.</span>recvline<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code>get_pin.py</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># written by hashkitten</span>\n<span class=\"token keyword\">from</span> itertools <span class=\"token keyword\">import</span> permutations<span class=\"token punctuation\">,</span> product\n<span class=\"token keyword\">from</span> math <span class=\"token keyword\">import</span> log2\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">match</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span>x<span class=\"token operator\">==</span>y <span class=\"token keyword\">for</span> x<span class=\"token punctuation\">,</span>y <span class=\"token keyword\">in</span> <span class=\"token builtin\">zip</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">check</span><span class=\"token punctuation\">(</span>guess<span class=\"token punctuation\">,</span> possibilities<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    l <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> possibilities<span class=\"token punctuation\">:</span>\n        l<span class=\"token punctuation\">[</span><span class=\"token string\">''</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> match<span class=\"token punctuation\">(</span>guess<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span>\n    nl <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        nl<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>v <span class=\"token keyword\">for</span> v <span class=\"token keyword\">in</span> l <span class=\"token keyword\">if</span> l<span class=\"token punctuation\">[</span>v<span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> i<span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">return</span> nl\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">entropy</span><span class=\"token punctuation\">(</span>nl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    tot <span class=\"token operator\">=</span> <span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> nl<span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    ent <span class=\"token operator\">=</span> <span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token operator\">/</span>tot<span class=\"token punctuation\">)</span><span class=\"token operator\">*</span>log2<span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token operator\">/</span>tot<span class=\"token punctuation\">)</span> <span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token keyword\">else</span> <span class=\"token number\">0</span> <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> nl<span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> ent\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">check_entropy</span><span class=\"token punctuation\">(</span>guess<span class=\"token punctuation\">,</span> possibilities<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> entropy<span class=\"token punctuation\">(</span>check<span class=\"token punctuation\">(</span>guess<span class=\"token punctuation\">,</span> possibilities<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_pin</span><span class=\"token punctuation\">(</span>digit_string<span class=\"token punctuation\">,</span> blackbox<span class=\"token punctuation\">,</span> fnum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    first_guess <span class=\"token operator\">=</span> <span class=\"token string\">'1234'</span>\n    possibilities <span class=\"token operator\">=</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span>permutations<span class=\"token punctuation\">(</span>digit_string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    possibilities <span class=\"token operator\">=</span> check<span class=\"token punctuation\">(</span>first_guess<span class=\"token punctuation\">,</span> possibilities<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>fnum<span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n        lls <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">for</span> possible_guess <span class=\"token keyword\">in</span> product<span class=\"token punctuation\">(</span>digit_string<span class=\"token punctuation\">,</span> repeat<span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            possible_guess <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>possible_guess<span class=\"token punctuation\">)</span>\n            lls<span class=\"token punctuation\">[</span>possible_guess<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> check_entropy<span class=\"token punctuation\">(</span>possible_guess<span class=\"token punctuation\">,</span> possibilities<span class=\"token punctuation\">)</span>\n        best_guess<span class=\"token punctuation\">,</span> ent <span class=\"token operator\">=</span> <span class=\"token builtin\">max</span><span class=\"token punctuation\">(</span>lls<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> key<span class=\"token operator\">=</span><span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span>x<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token number\">100</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">in</span> possibilities<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># print('Guessing {} with entropy {}'.format(best_guess, ent))</span>\n        num <span class=\"token operator\">=</span> blackbox<span class=\"token punctuation\">(</span>best_guess<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> num <span class=\"token operator\">==</span> <span class=\"token number\">4</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> best_guess\n        possibilities <span class=\"token operator\">=</span> check<span class=\"token punctuation\">(</span>best_guess<span class=\"token punctuation\">,</span> possibilities<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>num<span class=\"token punctuation\">]</span>\n        <span class=\"token comment\"># print('Remaining possibilities: {}'.format(possibilities))</span>\n        <span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>possibilities<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">assert</span> blackbox<span class=\"token punctuation\">(</span>possibilities<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">4</span>\n            <span class=\"token keyword\">return</span> possibilities<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n\nperf_count <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_avg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">for</span> p <span class=\"token keyword\">in</span> permutations<span class=\"token punctuation\">(</span><span class=\"token string\">'0123456789'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n        <span class=\"token keyword\">def</span> <span class=\"token function\">test_blackbox</span><span class=\"token punctuation\">(</span>guess<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">global</span> perf_count\n            perf_count <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n            <span class=\"token keyword\">return</span> match<span class=\"token punctuation\">(</span>guess<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">)</span>\n\n        digit_string <span class=\"token operator\">=</span> <span class=\"token builtin\">sorted</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span>\n        fnum <span class=\"token operator\">=</span> test_blackbox<span class=\"token punctuation\">(</span><span class=\"token string\">'1234'</span><span class=\"token punctuation\">)</span>\n        get_pin<span class=\"token punctuation\">(</span>digit_string<span class=\"token punctuation\">,</span> test_blackbox<span class=\"token punctuation\">,</span> fnum<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">global</span> perf_count\n    <span class=\"token keyword\">return</span> perf_count<span class=\"token operator\">/</span><span class=\"token number\">5040</span>\n\n<span class=\"token comment\"># for checking average requests per pin</span>\n<span class=\"token comment\"># print(get_avg()) # 3.815674603174603</span></code></pre></div>\n<p><code>xs128p.py</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> argparse\n<span class=\"token keyword\">import</span> struct\n<span class=\"token keyword\">from</span> decimal <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">from</span> z3 <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\n\n<span class=\"token comment\"># most code from https://github.com/d0nutptr/v8_rand_buster/blob/master/xs128p.py</span>\n\nMAX_UNUSED_THREADS <span class=\"token operator\">=</span> <span class=\"token number\">2</span>\n\n<span class=\"token comment\"># Calculates xs128p (XorShift128Plus)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">xs128p</span><span class=\"token punctuation\">(</span>state0<span class=\"token punctuation\">,</span> state1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    s1 <span class=\"token operator\">=</span> state0 <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xFFFFFFFFFFFFFFFF</span>\n    s0 <span class=\"token operator\">=</span> state1 <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xFFFFFFFFFFFFFFFF</span>\n    s1 <span class=\"token operator\">^</span><span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>s1 <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">23</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xFFFFFFFFFFFFFFFF</span>\n    s1 <span class=\"token operator\">^</span><span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>s1 <span class=\"token operator\">>></span> <span class=\"token number\">17</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xFFFFFFFFFFFFFFFF</span>\n    s1 <span class=\"token operator\">^</span><span class=\"token operator\">=</span> s0 <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xFFFFFFFFFFFFFFFF</span>\n    s1 <span class=\"token operator\">^</span><span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>s0 <span class=\"token operator\">>></span> <span class=\"token number\">26</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xFFFFFFFFFFFFFFFF</span>\n    state0 <span class=\"token operator\">=</span> state1 <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xFFFFFFFFFFFFFFFF</span>\n    state1 <span class=\"token operator\">=</span> s1 <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xFFFFFFFFFFFFFFFF</span>\n    generated <span class=\"token operator\">=</span> state0 <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xFFFFFFFFFFFFFFFF</span>\n    <span class=\"token keyword\">return</span> state0<span class=\"token punctuation\">,</span> state1<span class=\"token punctuation\">,</span> generated\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">sym_xs128p</span><span class=\"token punctuation\">(</span>sym_state0<span class=\"token punctuation\">,</span> sym_state1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># Symbolically represent xs128p</span>\n    s1 <span class=\"token operator\">=</span> sym_state0\n    s0 <span class=\"token operator\">=</span> sym_state1\n    s1 <span class=\"token operator\">^</span><span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>s1 <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">23</span><span class=\"token punctuation\">)</span>\n    s1 <span class=\"token operator\">^</span><span class=\"token operator\">=</span> LShR<span class=\"token punctuation\">(</span>s1<span class=\"token punctuation\">,</span> <span class=\"token number\">17</span><span class=\"token punctuation\">)</span>\n    s1 <span class=\"token operator\">^</span><span class=\"token operator\">=</span> s0\n    s1 <span class=\"token operator\">^</span><span class=\"token operator\">=</span> LShR<span class=\"token punctuation\">(</span>s0<span class=\"token punctuation\">,</span> <span class=\"token number\">26</span><span class=\"token punctuation\">)</span>\n    sym_state0 <span class=\"token operator\">=</span> sym_state1\n    sym_state1 <span class=\"token operator\">=</span> s1\n    <span class=\"token comment\"># end symbolic execution</span>\n\n    <span class=\"token keyword\">return</span> sym_state0<span class=\"token punctuation\">,</span> sym_state1\n\n<span class=\"token comment\"># from https://github.com/TACIXAT/XorShift128Plus/blob/master/xs128p.py</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">reverse17</span><span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> val <span class=\"token operator\">^</span> <span class=\"token punctuation\">(</span>val <span class=\"token operator\">>></span> <span class=\"token number\">17</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token punctuation\">(</span>val <span class=\"token operator\">>></span> <span class=\"token number\">34</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token punctuation\">(</span>val <span class=\"token operator\">>></span> <span class=\"token number\">51</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">reverse23</span><span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    MASK <span class=\"token operator\">=</span> <span class=\"token number\">0xFFFFFFFFFFFFFFFF</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>val <span class=\"token operator\">^</span> <span class=\"token punctuation\">(</span>val <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">23</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token punctuation\">(</span>val <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">46</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> MASK\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">xs128p_backward</span><span class=\"token punctuation\">(</span>state0<span class=\"token punctuation\">,</span> state1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    prev_state1 <span class=\"token operator\">=</span> state0\n    prev_state0 <span class=\"token operator\">=</span> state1 <span class=\"token operator\">^</span> <span class=\"token punctuation\">(</span>state0 <span class=\"token operator\">>></span> <span class=\"token number\">26</span><span class=\"token punctuation\">)</span>\n    prev_state0 <span class=\"token operator\">=</span> prev_state0 <span class=\"token operator\">^</span> state0\n    prev_state0 <span class=\"token operator\">=</span> reverse17<span class=\"token punctuation\">(</span>prev_state0<span class=\"token punctuation\">)</span>\n    prev_state0 <span class=\"token operator\">=</span> reverse23<span class=\"token punctuation\">(</span>prev_state0<span class=\"token punctuation\">)</span>\n    generated <span class=\"token operator\">=</span> prev_state0\n    <span class=\"token keyword\">return</span> prev_state0<span class=\"token punctuation\">,</span> prev_state1<span class=\"token punctuation\">,</span> generated\n\n<span class=\"token comment\"># Symbolic execution of xs128p</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">sym_floor_random</span><span class=\"token punctuation\">(</span>slvr<span class=\"token punctuation\">,</span> sym_state0<span class=\"token punctuation\">,</span> sym_state1<span class=\"token punctuation\">,</span> generated<span class=\"token punctuation\">,</span> multiple<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    sym_state0<span class=\"token punctuation\">,</span> sym_state1 <span class=\"token operator\">=</span> sym_xs128p<span class=\"token punctuation\">(</span>sym_state0<span class=\"token punctuation\">,</span> sym_state1<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># \"::ToDouble\"</span>\n    calc <span class=\"token operator\">=</span> LShR<span class=\"token punctuation\">(</span>sym_state0<span class=\"token punctuation\">,</span> <span class=\"token number\">12</span><span class=\"token punctuation\">)</span>\n    lower <span class=\"token operator\">=</span> from_double<span class=\"token punctuation\">(</span>Decimal<span class=\"token punctuation\">(</span>generated<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> Decimal<span class=\"token punctuation\">(</span>multiple<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    upper <span class=\"token operator\">=</span> from_double<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>Decimal<span class=\"token punctuation\">(</span>generated<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> Decimal<span class=\"token punctuation\">(</span>multiple<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    lower_mantissa <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>lower <span class=\"token operator\">&amp;</span> <span class=\"token number\">0x000FFFFFFFFFFFFF</span><span class=\"token punctuation\">)</span>\n    upper_mantissa <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>upper <span class=\"token operator\">&amp;</span> <span class=\"token number\">0x000FFFFFFFFFFFFF</span><span class=\"token punctuation\">)</span>\n    upper_expr <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>upper <span class=\"token operator\">>></span> <span class=\"token number\">52</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0x7FF</span>\n\n    slvr<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>And<span class=\"token punctuation\">(</span>lower_mantissa <span class=\"token operator\">&lt;=</span> calc<span class=\"token punctuation\">,</span> Or<span class=\"token punctuation\">(</span>upper_mantissa <span class=\"token operator\">>=</span> calc<span class=\"token punctuation\">,</span> upper_expr <span class=\"token operator\">==</span> <span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> sym_state0<span class=\"token punctuation\">,</span> sym_state1\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">solve_instance</span><span class=\"token punctuation\">(</span>points<span class=\"token punctuation\">,</span> multiple<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># setup symbolic state for xorshift128+</span>\n    ostate0<span class=\"token punctuation\">,</span> ostate1 <span class=\"token operator\">=</span> BitVecs<span class=\"token punctuation\">(</span><span class=\"token string\">'ostate0 ostate1'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">64</span><span class=\"token punctuation\">)</span>\n    sym_state0 <span class=\"token operator\">=</span> ostate0\n    sym_state1 <span class=\"token operator\">=</span> ostate1\n    set_option<span class=\"token punctuation\">(</span><span class=\"token string\">\"parallel.enable\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    set_option<span class=\"token punctuation\">(</span><span class=\"token string\">\"parallel.threads.max\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">max</span><span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">.</span>cpu_count<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> MAX_UNUSED_THREADS<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    slvr <span class=\"token operator\">=</span> SolverFor<span class=\"token punctuation\">(</span><span class=\"token string\">\"QF_BV\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">for</span> point <span class=\"token keyword\">in</span> points<span class=\"token punctuation\">:</span>\n        sym_state0<span class=\"token punctuation\">,</span> sym_state1 <span class=\"token operator\">=</span> sym_floor_random<span class=\"token punctuation\">(</span>slvr<span class=\"token punctuation\">,</span> sym_state0<span class=\"token punctuation\">,</span> sym_state1<span class=\"token punctuation\">,</span> point<span class=\"token punctuation\">,</span> multiple<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> slvr<span class=\"token punctuation\">.</span>check<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> sat<span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># get a solved state</span>\n        m <span class=\"token operator\">=</span> slvr<span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        state0 <span class=\"token operator\">=</span> m<span class=\"token punctuation\">[</span>ostate0<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>as_long<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        state1 <span class=\"token operator\">=</span> m<span class=\"token punctuation\">[</span>ostate1<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>as_long<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">return</span> state0<span class=\"token punctuation\">,</span> state1\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Failed to find a valid solution\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">to_double</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    double_bits <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>value <span class=\"token operator\">>></span> <span class=\"token number\">12</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> <span class=\"token number\">0x3FF0000000000000</span>\n    <span class=\"token keyword\">return</span> struct<span class=\"token punctuation\">.</span>unpack<span class=\"token punctuation\">(</span><span class=\"token string\">'d'</span><span class=\"token punctuation\">,</span> struct<span class=\"token punctuation\">.</span>pack<span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;Q'</span><span class=\"token punctuation\">,</span> double_bits<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">from_double</span><span class=\"token punctuation\">(</span>dbl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> struct<span class=\"token punctuation\">.</span>unpack<span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;Q'</span><span class=\"token punctuation\">,</span> struct<span class=\"token punctuation\">.</span>pack<span class=\"token punctuation\">(</span><span class=\"token string\">'d'</span><span class=\"token punctuation\">,</span> dbl <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0x7FFFFFFFFFFFFFFF</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">recover_lead</span><span class=\"token punctuation\">(</span>points<span class=\"token punctuation\">,</span> multiple<span class=\"token punctuation\">,</span> lead<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    state0<span class=\"token punctuation\">,</span> state1 <span class=\"token operator\">=</span> solve_instance<span class=\"token punctuation\">(</span>points<span class=\"token punctuation\">,</span> multiple<span class=\"token punctuation\">)</span>\n    o <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>math<span class=\"token punctuation\">.</span>floor<span class=\"token punctuation\">(</span>multiple<span class=\"token operator\">*</span>to_double<span class=\"token punctuation\">(</span>state0<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>lead<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        state0<span class=\"token punctuation\">,</span> state1<span class=\"token punctuation\">,</span> generated <span class=\"token operator\">=</span> xs128p_backward<span class=\"token punctuation\">(</span>state0<span class=\"token punctuation\">,</span> state1<span class=\"token punctuation\">)</span>\n        o<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>math<span class=\"token punctuation\">.</span>floor<span class=\"token punctuation\">(</span>multiple<span class=\"token operator\">*</span>to_double<span class=\"token punctuation\">(</span>generated<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> o\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">recover_next</span><span class=\"token punctuation\">(</span>points<span class=\"token punctuation\">,</span> multiple<span class=\"token punctuation\">,</span> N<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    state0<span class=\"token punctuation\">,</span> state1 <span class=\"token operator\">=</span> solve_instance<span class=\"token punctuation\">(</span>points<span class=\"token punctuation\">,</span> multiple<span class=\"token punctuation\">)</span>\n    out <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>N<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        state0<span class=\"token punctuation\">,</span> state1<span class=\"token punctuation\">,</span> output <span class=\"token operator\">=</span> xs128p<span class=\"token punctuation\">(</span>state0<span class=\"token punctuation\">,</span> state1<span class=\"token punctuation\">)</span>\n        out<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>math<span class=\"token punctuation\">.</span>floor<span class=\"token punctuation\">(</span>multiple <span class=\"token operator\">*</span> to_double<span class=\"token punctuation\">(</span>output<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> out</code></pre></div>\n<p>Flag: <code>hitcon{even_my_c4t_can_s0lve_4_digits_pin_4A999B}</code></p>","frontmatter":{"date":"November 30, 2020","path":"/posts/2020-11-30-hitcon-ctf-2020-100-pins-writeup","title":"HITCON CTF 2020 - 100 Pins","tags":"ctf,infosec,writeup,crypto"}}},"pageContext":{"prev":{"fileAbsolutePath":"/home/joseph/stuff/code/portfolio/src/posts/2020-11-23-dragon-ctf-2020-bit-flip-writeups/index.md","frontmatter":{"title":"Dragon CTF 2020 - Bit Flip","date":"2020-11-23T00:00:00.000Z","path":"/posts/2020-11-23-dragon-ctf-2020-bit-flip-writeups"}},"next":{"fileAbsolutePath":"/home/joseph/stuff/code/portfolio/src/posts/2020-12-21-hxp-ctf-2020-hyper-writeup/index.md","frontmatter":{"title":"hxp CTF 2020 - hyper","date":"2020-12-21T00:00:00.000Z","path":"/posts/2020-12-21-hxp-ctf-2020-hyper-writeup"}}}},
    "staticQueryHashes": ["4146750380"]}